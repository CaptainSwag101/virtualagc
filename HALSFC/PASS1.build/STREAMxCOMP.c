/*
  File STREAMxCOMP.c generated by XCOM-I, 2024-08-09 12:38:15.
*/

#include "runtimeC.h"

int32_t
STREAMxCOMP (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "STREAMxCOMP");
  // POINT =  197 +  29 * TYPE; (4513)
  {
    int32_t numberRHS
        = (int32_t)(xadd (197, xmultiply (29, getFIXED (mSTREAMxCOMPxTYPE))));
    putFIXED (mSTREAMxCOMPxPOINT, numberRHS);
  }
  // E_COUNT(TYPE) = 1; (4514)
  {
    int32_t numberRHS = (int32_t)(1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mSTREAMxE_COUNT + 2 * (getFIXED (mSTREAMxCOMPxTYPE)), bitRHS);
    bitRHS->inUse = 0;
  }
  // DO FOREVER; (4515)
  while (1 & (1))
    {
      // CALL SCAN_CARD(TYPE); (4516)
      {
        putFIXED (mSTREAMxSCAN_CARDxTYPE, getFIXED (mSTREAMxCOMPxTYPE));
        STREAMxSCAN_CARD (0);
      }
      // CALL READ_CARD; (4517)
      STREAMxREAD_CARD (0);
      // IF BYTE(CURRENT_CARD) ~= POINT THEN (4518)
      if (1
          & (xNEQ (BYTE1 (getCHARACTER (mCURRENT_CARD)),
                   getFIXED (mSTREAMxCOMPxPOINT))))
        // DO; (4519)
        {
        rs1s1:;
          // IF ~ORDER_OK(POINT) THEN (4520)
          if (1
              & (xNOT (bitToFixed (
                  (putFIXED (mORDER_OKxTYPE, getFIXED (mSTREAMxCOMPxPOINT)),
                   ORDER_OK (0))))))
            // CALL ERROR(CLASS_M,2); (4521)
            {
              putBITp (16, mERRORxCLASS, getBIT (16, mCLASS_M));
              putBITp (8, mERRORxNUM, fixedToBit (32, (int32_t)(2)));
              ERROR (0);
            }
          // POINT = SHL(TYPE, IND_SHIFT); (4522)
          {
            int32_t numberRHS
                = (int32_t)(SHL (getFIXED (mSTREAMxCOMPxTYPE), 7));
            putFIXED (mSTREAMxCOMPxPOINT, numberRHS);
          }
          // DO CP = 1 TO TEXT_LIMIT; (4523)
          {
            int32_t from79, to79, by79;
            from79 = 1;
            to79 = bitToFixed (getBIT (16, mTEXT_LIMIT));
            by79 = 1;
            for (putBIT (16, mSTREAMxCP, fixedToBit (16, from79));
                 bitToFixed (getBIT (16, mSTREAMxCP)) <= to79;
                 putBIT (16, mSTREAMxCP,
                         fixedToBit (16, bitToFixed (getBIT (16, mSTREAMxCP))
                                             + by79)))
              {
                // IF BYTE(E_LINE(TYPE), CP) = BYTE(X1) THEN (4524)
                if (1
                    & (xEQ (BYTE (getCHARACTER (
                                      mSTREAMxE_LINE
                                      + 4 * getFIXED (mSTREAMxCOMPxTYPE)),
                                  COREHALFWORD (mSTREAMxCP)),
                            BYTE1 (getCHARACTER (mX1)))))
                  // E_INDICATOR(CP + POINT) = 0; (4525)
                  {
                    int32_t numberRHS = (int32_t)(0);
                    descriptor_t *bitRHS;
                    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                    putBIT (16,
                            mSTREAMxE_INDICATOR
                                + 2
                                      * (xadd (COREHALFWORD (mSTREAMxCP),
                                               getFIXED (mSTREAMxCOMPxPOINT))),
                            bitRHS);
                    bitRHS->inUse = 0;
                  }
                // ELSE (4526)
                else
                  // IF ~TYPE THEN (4527)
                  if (1 & (xNOT (getFIXED (mSTREAMxCOMPxTYPE))))
                    // DO; (4528)
                    {
                    rs1s1s1s1:;
                      // FILL = E_COUNT - E_INDICATOR(CP) + 1; (4529)
                      {
                        int32_t numberRHS = (int32_t)(xadd (
                            xsubtract (COREHALFWORD (mSTREAMxE_COUNT),
                                       COREHALFWORD (
                                           mSTREAMxE_INDICATOR
                                           + 2 * COREHALFWORD (mSTREAMxCP))),
                            1));
                        descriptor_t *bitRHS;
                        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                        putBIT (16, mSTREAMxFILL, bitRHS);
                        bitRHS->inUse = 0;
                      }
                      // E_INDICATOR(CP) = FILL; (4530)
                      {
                        descriptor_t *bitRHS = getBIT (16, mSTREAMxFILL);
                        putBIT (16,
                                mSTREAMxE_INDICATOR
                                    + 2 * (COREHALFWORD (mSTREAMxCP)),
                                bitRHS);
                        bitRHS->inUse = 0;
                      }
                    es1s1s1s1:;
                    } // End of DO block
              }
          } // End of DO for-loop block
          // RETURN; (4531)
          {
            reentryGuard = 0;
            return 0;
          }
        es1s1:;
        } // End of DO block
      // E_COUNT(TYPE) = E_COUNT(TYPE) + 1; (4532)
      {
        int32_t numberRHS = (int32_t)(xadd (
            COREHALFWORD (mSTREAMxE_COUNT + 2 * getFIXED (mSTREAMxCOMPxTYPE)),
            1));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mSTREAMxE_COUNT + 2 * (getFIXED (mSTREAMxCOMPxTYPE)),
                bitRHS);
        bitRHS->inUse = 0;
      }
    } // End of DO WHILE block
  {
    reentryGuard = 0;
    return 0;
  }
}
