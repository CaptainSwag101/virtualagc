/*
  File STREAMxSTACK.c generated by XCOM-I, 2024-08-09 12:38:15.
*/

#include "runtimeC.h"

int32_t
STREAMxSTACK (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "STREAMxSTACK");
  // POINT = EP(TYPE) + SHL(TYPE, IND_SHIFT); (4643)
  {
    int32_t numberRHS = (int32_t)(xadd (
        COREHALFWORD (mSTREAMxEP + 2 * getFIXED (mSTREAMxSTACKxTYPE)),
        SHL (getFIXED (mSTREAMxSTACKxTYPE), 7)));
    putFIXED (mSTREAMxSTACKxPOINT, numberRHS);
  }
  // IF EP(TYPE) < 0 THEN (4644)
  if (1
      & (xLT (COREHALFWORD (mSTREAMxEP + 2 * getFIXED (mSTREAMxSTACKxTYPE)),
              0)))
    // GO TO NOT_MULTIPLE; (4645)
    goto NOT_MULTIPLE;
  // IF BYTE(E_LINE(TYPE), INDEX) = BYTE(X1) THEN (4646)
  if (1
      & (xEQ (BYTE (getCHARACTER (mSTREAMxE_LINE
                                  + 4 * getFIXED (mSTREAMxSTACKxTYPE)),
                    COREHALFWORD (mSTREAMxINDEX)),
              BYTE1 (getCHARACTER (mX1)))))
    // DO; (4647)
    {
    rs1:;
      // IF BYTE(E_STACK(TYPE), EP(TYPE)) = BYTE(X1) THEN (4648)
      if (1
          & (xEQ (BYTE (getCHARACTER (mSTREAMxE_STACK
                                      + 4 * getFIXED (mSTREAMxSTACKxTYPE)),
                        COREHALFWORD (mSTREAMxEP
                                      + 2 * getFIXED (mSTREAMxSTACKxTYPE))),
                  BYTE1 (getCHARACTER (mX1)))))
        // E_IND(POINT) = E_IND(POINT) + 1; (4649)
        {
          int32_t numberRHS = (int32_t)(xadd (
              COREHALFWORD (mSTREAMxE_IND
                            + 2 * getFIXED (mSTREAMxSTACKxPOINT)),
              1));
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (16, mSTREAMxE_IND + 2 * (getFIXED (mSTREAMxSTACKxPOINT)),
                  bitRHS);
          bitRHS->inUse = 0;
        }
      // ELSE (4650)
      else
        // GO TO NOT_MULTIPLE; (4651)
        goto NOT_MULTIPLE;
    es1:;
    } // End of DO block
  // ELSE (4652)
  else
    // DO; (4653)
    {
    rs2:;
    // NOT_MULTIPLE: (4654)
    NOT_MULTIPLE:
      // EP(TYPE) = EP(TYPE) + 1; (4655)
      {
        int32_t numberRHS = (int32_t)(xadd (
            COREHALFWORD (mSTREAMxEP + 2 * getFIXED (mSTREAMxSTACKxTYPE)), 1));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mSTREAMxEP + 2 * (getFIXED (mSTREAMxSTACKxTYPE)), bitRHS);
        bitRHS->inUse = 0;
      }
      // IF EP(TYPE) > IND_LIM THEN (4656)
      if (1
          & (xGT (
              COREHALFWORD (mSTREAMxEP + 2 * getFIXED (mSTREAMxSTACKxTYPE)),
              127)))
        // DO CASE TYPE; (4657)
        {
        rs2s1:
          switch (getFIXED (mSTREAMxSTACKxTYPE))
            {
            case 0:
              // CALL ERROR(CLASS_ME,1); (4659)
              {
                putBITp (16, mERRORxCLASS, getBIT (16, mCLASS_ME));
                putBITp (8, mERRORxNUM, fixedToBit (32, (int32_t)(1)));
                ERROR (0);
              }
              break;
            case 1:
              // CALL ERROR(CLASS_MS,1); (4660)
              {
                putBITp (16, mERRORxCLASS, getBIT (16, mCLASS_MS));
                putBITp (8, mERRORxNUM, fixedToBit (32, (int32_t)(1)));
                ERROR (0);
              }
              break;
            }
        } // End of DO CASE block
      // POINT = POINT + 1; (4660)
      {
        int32_t numberRHS
            = (int32_t)(xadd (getFIXED (mSTREAMxSTACKxPOINT), 1));
        putFIXED (mSTREAMxSTACKxPOINT, numberRHS);
      }
      // CHAR_TEMP = SUBSTR(E_LINE(TYPE), INDEX, 1); (4661)
      {
        descriptor_t *stringRHS;
        stringRHS = SUBSTR (
            getCHARACTER (mSTREAMxE_LINE + 4 * getFIXED (mSTREAMxSTACKxTYPE)),
            COREHALFWORD (mSTREAMxINDEX), 1);
        putCHARACTER (mSTREAMxCHAR_TEMP, stringRHS);
        stringRHS->inUse = 0;
      }
      // IF CHAR_TEMP ~= X1 THEN (4662)
      if (1 & (xsNEQ (getCHARACTER (mSTREAMxCHAR_TEMP), getCHARACTER (mX1))))
        // NONBLANK_FOUND = TRUE; (4663)
        {
          int32_t numberRHS = (int32_t)(1);
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (1, mNONBLANK_FOUND, bitRHS);
          bitRHS->inUse = 0;
        }
      // E_STACK(TYPE) = E_STACK(TYPE) || CHAR_TEMP; (4664)
      {
        descriptor_t *stringRHS;
        stringRHS = xsCAT (
            getCHARACTER (mSTREAMxE_STACK + 4 * getFIXED (mSTREAMxSTACKxTYPE)),
            getCHARACTER (mSTREAMxCHAR_TEMP));
        putCHARACTER (mSTREAMxE_STACK + 4 * (getFIXED (mSTREAMxSTACKxTYPE)),
                      stringRHS);
        stringRHS->inUse = 0;
      }
      // E_IND(POINT) = E_INDICATOR(INDEX + SHL(TYPE, IND_SHIFT)); (4665)
      {
        descriptor_t *bitRHS = getBIT (
            16, mSTREAMxE_INDICATOR
                    + 2
                          * xadd (COREHALFWORD (mSTREAMxINDEX),
                                  SHL (getFIXED (mSTREAMxSTACKxTYPE), 7)));
        putBIT (16, mSTREAMxE_IND + 2 * (getFIXED (mSTREAMxSTACKxPOINT)),
                bitRHS);
        bitRHS->inUse = 0;
      }
    es2:;
    } // End of DO block
  {
    reentryGuard = 0;
    return 0;
  }
}
