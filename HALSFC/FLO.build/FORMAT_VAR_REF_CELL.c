/*
  File FORMAT_VAR_REF_CELL.c generated by XCOM-I, 2024-08-09 12:38:39.
*/

#include "runtimeC.h"

int32_t
FORMAT_VAR_REF_CELL (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "FORMAT_VAR_REF_CELL");
  // CALL LOCATE(PTR,ADDR(VMEM_H),0); (2510)
  {
    putFIXED (mLOCATExPTR, getFIXED (mFORMAT_VAR_REF_CELLxPTR));
    putFIXED (mLOCATExBVAR, ADDR ("VMEM_H", 0x80000000, NULL, 0));
    putBITp (8, mLOCATExFLAGS, fixedToBit (32, (int32_t)(0)));
    LOCATE (0);
  }
  // COREWORD(ADDR(VMEM_F)) = VMEM_LOC_ADDR; (2511)
  {
    int32_t numberRHS = (int32_t)(getFIXED (mVMEM_LOC_ADDR));
    COREWORD2 (ADDR ("VMEM_F", 0x80000000, NULL, 0), numberRHS);
  }
  // IF VMEM_H(1) < 0 THEN (2512)
  if (1 & (xLT (COREHALFWORD (getFIXED (mVMEM_H) + 2 * 1), 0)))
    // DO; (2513)
    {
    rs1:;
      // SUBSCRIPTS = TRUE; (2514)
      {
        int32_t numberRHS = (int32_t)(1);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxSUBSCRIPTS, bitRHS);
        bitRHS->inUse = 0;
      }
      // #SYTS = VMEM_H(1) &  32767; (2515)
      {
        int32_t numberRHS = (int32_t)(xAND (
            COREHALFWORD (getFIXED (mVMEM_H) + 2 * 1), 32767));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mFORMAT_VAR_REF_CELLxpSYTS, bitRHS);
        bitRHS->inUse = 0;
      }
    es1:;
    } // End of DO block
  // ELSE (2516)
  else
    // DO; (2517)
    {
    rs2:;
      // SUBSCRIPTS = FALSE; (2518)
      {
        int32_t numberRHS = (int32_t)(0);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxSUBSCRIPTS, bitRHS);
        bitRHS->inUse = 0;
      }
      // #SYTS = VMEM_H(1); (2519)
      {
        descriptor_t *bitRHS = getBIT (16, getFIXED (mVMEM_H) + 2 * 1);
        putBIT (16, mFORMAT_VAR_REF_CELLxpSYTS, bitRHS);
        bitRHS->inUse = 0;
      }
    es2:;
    } // End of DO block
  // MSG = HEX(PTR,8) || ' --> ' || SYT_NAME(VMEM_H(4)); (2520)
  {
    descriptor_t *stringRHS;
    stringRHS = xsCAT (
        xsCAT ((putFIXED (mHEXxHVAL, getFIXED (mFORMAT_VAR_REF_CELLxPTR)),
                putFIXED (mHEXxN, 8), HEX (0)),
               cToDescriptor (NULL, " --> ")),
        getCHARACTER (getFIXED (mSYM_TAB)
                      + 34 * (COREHALFWORD (getFIXED (mVMEM_H) + 2 * 4)) + 0
                      + 4 * (0)));
    putCHARACTER (mMSG, stringRHS);
    stringRHS->inUse = 0;
  }
  // DO J = 5 TO #SYTS+3; (2521)
  {
    int32_t from52, to52, by52;
    from52 = 5;
    to52 = xadd (COREHALFWORD (mFORMAT_VAR_REF_CELLxpSYTS), 3);
    by52 = 1;
    for (putBIT (16, mFORMAT_VAR_REF_CELLxJ, fixedToBit (16, from52));
         bitToFixed (getBIT (16, mFORMAT_VAR_REF_CELLxJ)) <= to52; putBIT (
             16, mFORMAT_VAR_REF_CELLxJ,
             fixedToBit (16, bitToFixed (getBIT (16, mFORMAT_VAR_REF_CELLxJ))
                                 + by52)))
      {
        // MSG = MSG || '.' || SYT_NAME(VMEM_H(J)); (2522)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (
              xsCAT (getCHARACTER (mMSG), cToDescriptor (NULL, ".")),
              getCHARACTER (
                  getFIXED (mSYM_TAB)
                  + 34
                        * (COREHALFWORD (
                            getFIXED (mVMEM_H)
                            + 2 * COREHALFWORD (mFORMAT_VAR_REF_CELLxJ)))
                  + 0 + 4 * (0)));
          putCHARACTER (mMSG, stringRHS);
          stringRHS->inUse = 0;
        }
      }
  } // End of DO for-loop block
  // IF ~SUBSCRIPTS THEN (2523)
  if (1 & (xNOT (BYTE0 (mFORMAT_VAR_REF_CELLxSUBSCRIPTS))))
    // DO; (2524)
    {
    rs4:;
      // IF NO_PRINT THEN (2525)
      if (1 & (bitToFixed (getBIT (8, mFORMAT_VAR_REF_CELLxNO_PRINT))))
        // MSG = SUBSTR(MSG,13); (2526)
        {
          descriptor_t *stringRHS;
          stringRHS = SUBSTR2 (getCHARACTER (mMSG), 13);
          putCHARACTER (mMSG, stringRHS);
          stringRHS->inUse = 0;
        }
      // ELSE (2527)
      else
        // DO; (2528)
        {
        rs4s1:;
          // S = MSG; (2529)
          {
            descriptor_t *stringRHS;
            stringRHS = getCHARACTER (mMSG);
            putCHARACTER (mS, stringRHS);
            stringRHS->inUse = 0;
          }
          // CALL FLUSH(0); (2530)
          {
            putBITp (16, mFLUSHxLAST, fixedToBit (32, (int32_t)(0)));
            FLUSH (0);
          }
        es4s1:;
        } // End of DO block
      // NO_PRINT = FALSE; (2531)
      {
        int32_t numberRHS = (int32_t)(0);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxNO_PRINT, bitRHS);
        bitRHS->inUse = 0;
      }
      // RETURN; (2532)
      {
        reentryGuard = 0;
        return 0;
      }
    es4:;
    } // End of DO block
  // J = #SYTS + 4; (2533)
  {
    int32_t numberRHS
        = (int32_t)(xadd (COREHALFWORD (mFORMAT_VAR_REF_CELLxpSYTS), 4));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mFORMAT_VAR_REF_CELLxJ, bitRHS);
    bitRHS->inUse = 0;
  }
  // MSG(1) = '$('; (2534)
  {
    descriptor_t *stringRHS;
    stringRHS = cToDescriptor (NULL, "$(");
    putCHARACTER (mMSG + 4 * (1), stringRHS);
    stringRHS->inUse = 0;
  }
  // MSG(2), MSG(3) = ''; (2535)
  {
    descriptor_t *stringRHS;
    stringRHS = cToDescriptor (NULL, "");
    putCHARACTER (mMSG + 4 * (2), stringRHS);
    putCHARACTER (mMSG + 4 * (3), stringRHS);
    stringRHS->inUse = 0;
  }
  // LAST_SUB_TYPE = -1; (2536)
  {
    int32_t numberRHS = (int32_t)(-1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mFORMAT_VAR_REF_CELLxLAST_SUB_TYPE, bitRHS);
    bitRHS->inUse = 0;
  }
  // DO WHILE J <= SHR(VMEM_H(0),1) - 1; (2537)
  while (1
         & (xLE (COREHALFWORD (mFORMAT_VAR_REF_CELLxJ),
                 xsubtract (SHR (COREHALFWORD (getFIXED (mVMEM_H) + 2 * 0), 1),
                            1))))
    {
      // ALPHA = SHR(VMEM_H(J),8) & 3; (2538)
      {
        int32_t numberRHS = (int32_t)(xAND (
            SHR (COREHALFWORD (getFIXED (mVMEM_H)
                               + 2 * COREHALFWORD (mFORMAT_VAR_REF_CELLxJ)),
                 8),
            3));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxALPHA, bitRHS);
        bitRHS->inUse = 0;
      }
      // SUB_TYPE = SHR(VMEM_H(J),10) & 3; (2539)
      {
        int32_t numberRHS = (int32_t)(xAND (
            SHR (COREHALFWORD (getFIXED (mVMEM_H)
                               + 2 * COREHALFWORD (mFORMAT_VAR_REF_CELLxJ)),
                 10),
            3));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxSUB_TYPE, bitRHS);
        bitRHS->inUse = 0;
      }
      // BETA = VMEM_H(J) &  15; (2540)
      {
        int32_t numberRHS = (int32_t)(xAND (
            COREHALFWORD (getFIXED (mVMEM_H)
                          + 2 * COREHALFWORD (mFORMAT_VAR_REF_CELLxJ)),
            15));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxBETA, bitRHS);
        bitRHS->inUse = 0;
      }
      // EXP_TYPE = SHR(VMEM_H(J),4) &  15; (2541)
      {
        int32_t numberRHS = (int32_t)(xAND (
            SHR (COREHALFWORD (getFIXED (mVMEM_H)
                               + 2 * COREHALFWORD (mFORMAT_VAR_REF_CELLxJ)),
                 4),
            15));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mFORMAT_VAR_REF_CELLxEXP_TYPE, bitRHS);
        bitRHS->inUse = 0;
      }
      // MSG(3) = MSG(3) || EXP_STRINGS(SHR(EXP_TYPE,1)); (2542)
      {
        descriptor_t *stringRHS;
        stringRHS = xsCAT (
            getCHARACTER (mMSG + 4 * 3),
            getCHARACTER (
                mFORMAT_VAR_REF_CELLxEXP_STRINGS
                + 4 * SHR (BYTE0 (mFORMAT_VAR_REF_CELLxEXP_TYPE), 1)));
        putCHARACTER (mMSG + 4 * (3), stringRHS);
        stringRHS->inUse = 0;
      }
      // IF EXP_TYPE THEN (2543)
      if (1 & (bitToFixed (getBIT (8, mFORMAT_VAR_REF_CELLxEXP_TYPE))))
        // DO; (2544)
        {
        rs5s1:;
          // J = J + 1; (2545)
          {
            int32_t numberRHS
                = (int32_t)(xadd (COREHALFWORD (mFORMAT_VAR_REF_CELLxJ), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mFORMAT_VAR_REF_CELLxJ, bitRHS);
            bitRHS->inUse = 0;
          }
          // MSG(3) = MSG(3) || VMEM_H(J); (2546)
          {
            descriptor_t *stringRHS;
            stringRHS = xsCAT (
                getCHARACTER (mMSG + 4 * 3),
                bitToCharacter (getBIT (
                    16, getFIXED (mVMEM_H)
                            + 2 * COREHALFWORD (mFORMAT_VAR_REF_CELLxJ))));
            putCHARACTER (mMSG + 4 * (3), stringRHS);
            stringRHS->inUse = 0;
          }
        es5s1:;
        } // End of DO block
      // ELSE (2547)
      else
        // MSG(3) = MSG(3) || '?'; (2548)
        {
          descriptor_t *stringRHS;
          stringRHS
              = xsCAT (getCHARACTER (mMSG + 4 * 3), cToDescriptor (NULL, "?"));
          putCHARACTER (mMSG + 4 * (3), stringRHS);
          stringRHS->inUse = 0;
        }
      // DO CASE ALPHA; (2549)
      {
      rs5s2:
        switch (BYTE0 (mFORMAT_VAR_REF_CELLxALPHA))
          {
          case 0:
            // MSG(3) = '*'; (2551)
            {
              descriptor_t *stringRHS;
              stringRHS = cToDescriptor (NULL, "*");
              putCHARACTER (mMSG + 4 * (3), stringRHS);
              stringRHS->inUse = 0;
            }
            break;
          case 1:
              // ; (2552)
              ;
            break;
          case 2:
            // IF BETA THEN (2553)
            if (1 & (bitToFixed (getBIT (8, mFORMAT_VAR_REF_CELLxBETA))))
              {
                descriptor_t *stringRHS;
                stringRHS = xsCAT (getCHARACTER (mMSG + 4 * 3),
                                   cToDescriptor (NULL, " TO "));
                putCHARACTER (mMSG + 4 * (3), stringRHS);
                stringRHS->inUse = 0;
              }
            break;
          case 3:
            // IF BETA THEN (2555)
            if (1 & (bitToFixed (getBIT (8, mFORMAT_VAR_REF_CELLxBETA))))
              {
                descriptor_t *stringRHS;
                stringRHS = xsCAT (getCHARACTER (mMSG + 4 * 3),
                                   cToDescriptor (NULL, " AT "));
                putCHARACTER (mMSG + 4 * (3), stringRHS);
                stringRHS->inUse = 0;
              }
            break;
          }
      } // End of DO CASE block
      // IF BETA = 0 THEN (2556)
      if (1 & (xEQ (BYTE0 (mFORMAT_VAR_REF_CELLxBETA), 0)))
        // DO; (2557)
        {
        rs5s3:;
          // IF LAST_SUB_TYPE >= 0 THEN (2558)
          if (1 & (xGE (COREHALFWORD (mFORMAT_VAR_REF_CELLxLAST_SUB_TYPE), 0)))
            // IF SUB_TYPE~=LAST_SUB_TYPE THEN (2559)
            if (1
                & (xNEQ (BYTE0 (mFORMAT_VAR_REF_CELLxSUB_TYPE),
                         COREHALFWORD (mFORMAT_VAR_REF_CELLxLAST_SUB_TYPE))))
              // MSG(2)=SUB_STRINGS(LAST_SUB_TYPE); (2560)
              {
                descriptor_t *stringRHS;
                stringRHS = getCHARACTER (
                    mFORMAT_VAR_REF_CELLxSUB_STRINGS
                    + 4 * COREHALFWORD (mFORMAT_VAR_REF_CELLxLAST_SUB_TYPE));
                putCHARACTER (mMSG + 4 * (2), stringRHS);
                stringRHS->inUse = 0;
              }
            // ELSE (2561)
            else
              // MSG(2) = ','; (2562)
              {
                descriptor_t *stringRHS;
                stringRHS = cToDescriptor (NULL, ",");
                putCHARACTER (mMSG + 4 * (2), stringRHS);
                stringRHS->inUse = 0;
              }
          // LAST_SUB_TYPE = SUB_TYPE; (2563)
          {
            descriptor_t *bitRHS = getBIT (8, mFORMAT_VAR_REF_CELLxSUB_TYPE);
            putBIT (16, mFORMAT_VAR_REF_CELLxLAST_SUB_TYPE, bitRHS);
            bitRHS->inUse = 0;
          }
          // MSG(1) = MSG(1) || MSG(2) || MSG(3); (2564)
          {
            descriptor_t *stringRHS;
            stringRHS = xsCAT (xsCAT (getCHARACTER (mMSG + 4 * 1),
                                      getCHARACTER (mMSG + 4 * 2)),
                               getCHARACTER (mMSG + 4 * 3));
            putCHARACTER (mMSG + 4 * (1), stringRHS);
            stringRHS->inUse = 0;
          }
          // MSG(3) = ''; (2565)
          {
            descriptor_t *stringRHS;
            stringRHS = cToDescriptor (NULL, "");
            putCHARACTER (mMSG + 4 * (3), stringRHS);
            stringRHS->inUse = 0;
          }
        es5s3:;
        } // End of DO block
      // J = J + 1; (2566)
      {
        int32_t numberRHS
            = (int32_t)(xadd (COREHALFWORD (mFORMAT_VAR_REF_CELLxJ), 1));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mFORMAT_VAR_REF_CELLxJ, bitRHS);
        bitRHS->inUse = 0;
      }
    } // End of DO WHILE block
  // IF SUB_TYPE=1 | SUB_TYPE=2 THEN (2567)
  if (1
      & (xOR (xEQ (BYTE0 (mFORMAT_VAR_REF_CELLxSUB_TYPE), 1),
              xEQ (BYTE0 (mFORMAT_VAR_REF_CELLxSUB_TYPE), 2))))
    // MSG(1)=MSG(1)||SUB_STRINGS(SUB_TYPE); (2568)
    {
      descriptor_t *stringRHS;
      stringRHS
          = xsCAT (getCHARACTER (mMSG + 4 * 1),
                   getCHARACTER (mFORMAT_VAR_REF_CELLxSUB_STRINGS
                                 + 4 * BYTE0 (mFORMAT_VAR_REF_CELLxSUB_TYPE)));
      putCHARACTER (mMSG + 4 * (1), stringRHS);
      stringRHS->inUse = 0;
    }
  // MSG(1) = MSG(1) || ')'; (2569)
  {
    descriptor_t *stringRHS;
    stringRHS = xsCAT (getCHARACTER (mMSG + 4 * 1), cToDescriptor (NULL, ")"));
    putCHARACTER (mMSG + 4 * (1), stringRHS);
    stringRHS->inUse = 0;
  }
  // MSG(2), MSG(3) = ''; (2570)
  {
    descriptor_t *stringRHS;
    stringRHS = cToDescriptor (NULL, "");
    putCHARACTER (mMSG + 4 * (2), stringRHS);
    putCHARACTER (mMSG + 4 * (3), stringRHS);
    stringRHS->inUse = 0;
  }
  // IF VMEM_F(1) ~= 0 THEN (2571)
  if (1 & (xNEQ (getFIXED (getFIXED (mVMEM_F) + 4 * 1), 0)))
    // DO; (2572)
    {
    rs6:;
      // MSG(1) = MSG(1) || ' , ' || HEX(VMEM_F(1),8); (2573)
      {
        descriptor_t *stringRHS;
        stringRHS = xsCAT (
            xsCAT (getCHARACTER (mMSG + 4 * 1), cToDescriptor (NULL, " , ")),
            (putFIXED (mHEXxHVAL, getFIXED (getFIXED (mVMEM_F) + 4 * 1)),
             putFIXED (mHEXxN, 8), HEX (0)));
        putCHARACTER (mMSG + 4 * (1), stringRHS);
        stringRHS->inUse = 0;
      }
      // CALL STACK_PTR(VMEM_F(1) |  2147483648,LEVEL+1); (2574)
      {
        putFIXED (mSTACK_PTRxPTR,
                  xOR (getFIXED (getFIXED (mVMEM_F) + 4 * 1), 2147483648));
        putBITp (16, mSTACK_PTRxLEVEL,
                 fixedToBit (32, (int32_t)(xadd (COREHALFWORD (mLEVEL), 1))));
        STACK_PTR (0);
      }
    es6:;
    } // End of DO block
  // IF NO_PRINT THEN (2575)
  if (1 & (bitToFixed (getBIT (8, mFORMAT_VAR_REF_CELLxNO_PRINT))))
    // MSG = SUBSTR(MSG,13) || MSG(1); (2576)
    {
      descriptor_t *stringRHS;
      stringRHS = xsCAT (SUBSTR2 (getCHARACTER (mMSG), 13),
                         getCHARACTER (mMSG + 4 * 1));
      putCHARACTER (mMSG, stringRHS);
      stringRHS->inUse = 0;
    }
  // ELSE (2577)
  else
    // DO; (2578)
    {
    rs7:;
      // S = MSG; (2579)
      {
        descriptor_t *stringRHS;
        stringRHS = getCHARACTER (mMSG);
        putCHARACTER (mS, stringRHS);
        stringRHS->inUse = 0;
      }
      // S(1) = MSG(1); (2580)
      {
        descriptor_t *stringRHS;
        stringRHS = getCHARACTER (mMSG + 4 * 1);
        putCHARACTER (mS + 4 * (1), stringRHS);
        stringRHS->inUse = 0;
      }
      // CALL FLUSH(1); (2581)
      {
        putBITp (16, mFLUSHxLAST, fixedToBit (32, (int32_t)(1)));
        FLUSH (0);
      }
    es7:;
    } // End of DO block
  // NO_PRINT = FALSE; (2582)
  {
    int32_t numberRHS = (int32_t)(0);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (8, mFORMAT_VAR_REF_CELLxNO_PRINT, bitRHS);
    bitRHS->inUse = 0;
  }
  {
    reentryGuard = 0;
    return 0;
  }
}
