/*
  File FLUSH.c generated by XCOM-I, 2024-08-09 12:38:39.
*/

#include "runtimeC.h"

int32_t
FLUSH (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "FLUSH");
  // J = 10 + 3*LEVEL; (2453)
  {
    int32_t numberRHS
        = (int32_t)(xadd (10, xmultiply (3, COREHALFWORD (mLEVEL))));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mFLUSHxJ, bitRHS);
    bitRHS->inUse = 0;
  }
  // OFFSET = SUBSTR(X70,0,J); (2454)
  {
    descriptor_t *stringRHS;
    stringRHS = SUBSTR (getCHARACTER (mX70), 0, COREHALFWORD (mFLUSHxJ));
    putCHARACTER (mFLUSHxOFFSET, stringRHS);
    stringRHS->inUse = 0;
  }
  // J = 0; (2455)
  {
    int32_t numberRHS = (int32_t)(0);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mFLUSHxJ, bitRHS);
    bitRHS->inUse = 0;
  }
  // STRING = OFFSET; (2456)
  {
    descriptor_t *stringRHS;
    stringRHS = getCHARACTER (mFLUSHxOFFSET);
    putCHARACTER (mFLUSHxSTRING, stringRHS);
    stringRHS->inUse = 0;
  }
  // DO WHILE J <= LAST; (2457)
  while (1 & (xLE (COREHALFWORD (mFLUSHxJ), COREHALFWORD (mFLUSHxLAST))))
    {
      // IF LENGTH(STRING) + LENGTH(S(J)) < LINELENGTH THEN (2458)
      if (1
          & (xLT (
              xadd (LENGTH (getCHARACTER (mFLUSHxSTRING)),
                    LENGTH (getCHARACTER (mS + 4 * COREHALFWORD (mFLUSHxJ)))),
              131)))
        // DO; (2459)
        {
        rs1s1:;
          // STRING = STRING || S(J); (2460)
          {
            descriptor_t *stringRHS;
            stringRHS
                = xsCAT (getCHARACTER (mFLUSHxSTRING),
                         getCHARACTER (mS + 4 * COREHALFWORD (mFLUSHxJ)));
            putCHARACTER (mFLUSHxSTRING, stringRHS);
            stringRHS->inUse = 0;
          }
          // S(J) = ''; (2461)
          {
            descriptor_t *stringRHS;
            stringRHS = cToDescriptor (NULL, "");
            putCHARACTER (mS + 4 * (COREHALFWORD (mFLUSHxJ)), stringRHS);
            stringRHS->inUse = 0;
          }
          // J = J + 1; (2462)
          {
            int32_t numberRHS = (int32_t)(xadd (COREHALFWORD (mFLUSHxJ), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mFLUSHxJ, bitRHS);
            bitRHS->inUse = 0;
          }
        es1s1:;
        } // End of DO block
      // ELSE (2463)
      else
        // DO; (2464)
        {
        rs1s2:;
          // I,K = LINELENGTH - LENGTH(STRING) - 1; (2465)
          {
            int32_t numberRHS = (int32_t)(xsubtract (
                xsubtract (131, LENGTH (getCHARACTER (mFLUSHxSTRING))), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mFLUSHxI, bitRHS);
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mFLUSHxK, bitRHS);
            bitRHS->inUse = 0;
          }
          // DO WHILE BYTE(S(J),I)~=BYTE(' ') & BYTE(S(J),I)~=BYTE(',') & I>0;
          // (2466)
          while (
              1
              & (xAND (xAND (xNEQ (BYTE (getCHARACTER (
                                             mS + 4 * COREHALFWORD (mFLUSHxJ)),
                                         COREHALFWORD (mFLUSHxI)),
                                   BYTE1 (cToDescriptor (NULL, " "))),
                             xNEQ (BYTE (getCHARACTER (
                                             mS + 4 * COREHALFWORD (mFLUSHxJ)),
                                         COREHALFWORD (mFLUSHxI)),
                                   BYTE1 (cToDescriptor (NULL, ",")))),
                       xGT (COREHALFWORD (mFLUSHxI), 0))))
            {
              // I = I - 1; (2467)
              {
                int32_t numberRHS
                    = (int32_t)(xsubtract (COREHALFWORD (mFLUSHxI), 1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mFLUSHxI, bitRHS);
                bitRHS->inUse = 0;
              }
            } // End of DO WHILE block
          // IF I=0 THEN (2468)
          if (1 & (xEQ (COREHALFWORD (mFLUSHxI), 0)))
            // DO; (2469)
            {
            rs1s2s2:;
              // I = K; (2470)
              {
                descriptor_t *bitRHS = getBIT (16, mFLUSHxK);
                putBIT (16, mFLUSHxI, bitRHS);
                bitRHS->inUse = 0;
              }
              // DO WHILE BYTE(S(J))~=BYTE('.') & I>0; (2471)
              while (1
                     & (xAND (xNEQ (BYTE1 (getCHARACTER (
                                        mS + 4 * COREHALFWORD (mFLUSHxJ))),
                                    BYTE1 (cToDescriptor (NULL, "."))),
                              xGT (COREHALFWORD (mFLUSHxI), 0))))
                {
                  // I = I - 1; (2472)
                  {
                    int32_t numberRHS
                        = (int32_t)(xsubtract (COREHALFWORD (mFLUSHxI), 1));
                    descriptor_t *bitRHS;
                    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                    putBIT (16, mFLUSHxI, bitRHS);
                    bitRHS->inUse = 0;
                  }
                } // End of DO WHILE block
              // IF I = 0 THEN (2473)
              if (1 & (xEQ (COREHALFWORD (mFLUSHxI), 0)))
                // I = K; (2474)
                {
                  descriptor_t *bitRHS = getBIT (16, mFLUSHxK);
                  putBIT (16, mFLUSHxI, bitRHS);
                  bitRHS->inUse = 0;
                }
            es1s2s2:;
            } // End of DO block
          // OUTPUT = STRING || SUBSTR(S(J),0,I+1); (2475)
          {
            descriptor_t *stringRHS;
            stringRHS = xsCAT (
                getCHARACTER (mFLUSHxSTRING),
                SUBSTR (getCHARACTER (mS + 4 * COREHALFWORD (mFLUSHxJ)), 0,
                        xadd (COREHALFWORD (mFLUSHxI), 1)));
            OUTPUT (0, stringRHS);
            stringRHS->inUse = 0;
          }
          // S(J) = SUBSTR(S(J),I+1); (2476)
          {
            descriptor_t *stringRHS;
            stringRHS
                = SUBSTR2 (getCHARACTER (mS + 4 * COREHALFWORD (mFLUSHxJ)),
                           xadd (COREHALFWORD (mFLUSHxI), 1));
            putCHARACTER (mS + 4 * (COREHALFWORD (mFLUSHxJ)), stringRHS);
            stringRHS->inUse = 0;
          }
          // IF NO_PTR THEN (2477)
          if (1 & (bitToFixed (getBIT (8, mFLUSHxNO_PTR))))
            // STRING = OFFSET || X3; (2478)
            {
              descriptor_t *stringRHS;
              stringRHS
                  = xsCAT (getCHARACTER (mFLUSHxOFFSET), getCHARACTER (mX3));
              putCHARACTER (mFLUSHxSTRING, stringRHS);
              stringRHS->inUse = 0;
            }
          // ELSE (2479)
          else
            // STRING = OFFSET || X13; (2480)
            {
              descriptor_t *stringRHS;
              stringRHS
                  = xsCAT (getCHARACTER (mFLUSHxOFFSET), getCHARACTER (mX13));
              putCHARACTER (mFLUSHxSTRING, stringRHS);
              stringRHS->inUse = 0;
            }
        es1s2:;
        } // End of DO block
    }     // End of DO WHILE block
  // OUTPUT = STRING; (2481)
  {
    descriptor_t *stringRHS;
    stringRHS = getCHARACTER (mFLUSHxSTRING);
    OUTPUT (0, stringRHS);
    stringRHS->inUse = 0;
  }
  // NO_PTR = 0; (2482)
  {
    int32_t numberRHS = (int32_t)(0);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (8, mFLUSHxNO_PTR, bitRHS);
    bitRHS->inUse = 0;
  }
  {
    reentryGuard = 0;
    return 0;
  }
}
