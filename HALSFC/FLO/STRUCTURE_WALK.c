/*
  File STRUCTURE_WALK.c generated by XCOM-I, 2024-08-08 04:31:35.
*/

#include "runtimeC.h"

int32_t
STRUCTURE_WALK (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "STRUCTURE_WALK");
  // IF PROC_TRACE THEN (1395)
  if (1 & (bitToFixed (getBIT (8, mPROC_TRACE))))
    // OUTPUT='STRUCTURE_WALK('||SYT_NAME(STRUCT_TEMPL)||')'; (1396)
    {
      descriptor_t *stringRHS;
      stringRHS
          = xsCAT (xsCAT (cToDescriptor (NULL, "STRUCTURE_WALK("),
                          getCHARACTER (getFIXED (mSYM_TAB)
                                        + 34 * (COREHALFWORD (mSTRUCT_TEMPL))
                                        + 0 + 4 * (0))),
                   cToDescriptor (NULL, ")"));
      OUTPUT (0, stringRHS);
      stringRHS->inUse = 0;
    }
  // STRUCT_REF,TERM_LIST_HEAD = 0; (1397)
  {
    int32_t numberRHS = (int32_t)(0);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mSTRUCT_REF, bitRHS);
    putFIXED (mTERM_LIST_HEAD, numberRHS);
    bitRHS->inUse = 0;
  }
  // INITWALK = -1; (1398)
  {
    int32_t numberRHS = (int32_t)(-1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mSTRUCTURE_WALKxINITWALK, bitRHS);
    bitRHS->inUse = 0;
  }
  // N = 1; (1399)
  {
    int32_t numberRHS = (int32_t)(1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mSTRUCTURE_WALKxN, bitRHS);
    bitRHS->inUse = 0;
  }
  // DO FOREVER; (1400)
  while (1 & (1))
    {
      // IF N = 1 THEN (1401)
      if (1 & (xEQ (COREHALFWORD (mSTRUCTURE_WALKxN), 1)))
        // DO; (1402)
        {
        rs1s1:;
          // INITOP = STRUCTURE_ADVANCE; (1403)
          {
            descriptor_t *bitRHS = STRUCTURE_ADVANCE (0);
            putBIT (16, mSTRUCTURE_WALKxINITOP, bitRHS);
            bitRHS->inUse = 0;
          }
          // IF WALK_TRACE THEN (1404)
          if (1 & (bitToFixed (getBIT (8, mWALK_TRACE))))
            // DO; (1405)
            {
            rs1s1s1:;
              // MSG = ''; (1406)
              {
                descriptor_t *stringRHS;
                stringRHS = cToDescriptor (NULL, "");
                putCHARACTER (mMSG, stringRHS);
                stringRHS->inUse = 0;
              }
              // DO J = 1 TO TEMPL_INX; (1407)
              {
                int32_t from30, to30, by30;
                from30 = 1;
                to30 = bitToFixed (getBIT (16, mTEMPL_INX));
                by30 = 1;
                for (putBIT (16, mSTRUCTURE_WALKxJ, fixedToBit (16, from30));
                     bitToFixed (getBIT (16, mSTRUCTURE_WALKxJ)) <= to30;
                     putBIT (16, mSTRUCTURE_WALKxJ,
                             fixedToBit (16, bitToFixed (getBIT (
                                                 16, mSTRUCTURE_WALKxJ))
                                                 + by30)))
                  {
                    // MSG=MSG||SYT_NAME(TEMPL_LIST(J))||'.'; (1408)
                    {
                      descriptor_t *stringRHS;
                      stringRHS = xsCAT (
                          xsCAT (getCHARACTER (mMSG),
                                 getCHARACTER (
                                     getFIXED (mSYM_TAB)
                                     + 34
                                           * (COREHALFWORD (
                                               mTEMPL_LIST
                                               + 2
                                                     * COREHALFWORD (
                                                         mSTRUCTURE_WALKxJ)))
                                     + 0 + 4 * (0))),
                          cToDescriptor (NULL, "."));
                      putCHARACTER (mMSG, stringRHS);
                      stringRHS->inUse = 0;
                    }
                  }
              } // End of DO for-loop block
              // OUTPUT=MSG||SYT_NAME(INITOP); (1409)
              {
                descriptor_t *stringRHS;
                stringRHS
                    = xsCAT (getCHARACTER (mMSG),
                             getCHARACTER (
                                 getFIXED (mSYM_TAB)
                                 + 34 * (COREHALFWORD (mSTRUCTURE_WALKxINITOP))
                                 + 0 + 4 * (0)));
                OUTPUT (0, stringRHS);
                stringRHS->inUse = 0;
              }
            es1s1s1:;
            } // End of DO block
          // IF INITOP = 0 THEN (1410)
          if (1 & (xEQ (COREHALFWORD (mSTRUCTURE_WALKxINITOP), 0)))
            // DO; (1411)
            {
            rs1s1s2:;
              // IF TERM_LIST_HEAD ~= 0 THEN (1412)
              if (1 & (xNEQ (getFIXED (mTERM_LIST_HEAD), 0)))
                // CALL PTR_LOCATE(OLD_CELL,RELS); (1413)
                {
                  putFIXED (mPTR_LOCATExPTR,
                            getFIXED (mSTRUCTURE_WALKxOLD_CELL));
                  putBITp (8, mPTR_LOCATExFLAGS, getBIT (8, mRELS));
                  PTR_LOCATE (0);
                }
              // TEMPL_WIDTH = INITWALK + 1; (1414)
              {
                int32_t numberRHS = (int32_t)(xadd (
                    COREHALFWORD (mSTRUCTURE_WALKxINITWALK), 1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mTEMPL_WIDTH, bitRHS);
                bitRHS->inUse = 0;
              }
              // RETURN; (1415)
              {
                reentryGuard = 0;
                return 0;
              }
            es1s1s2:;
            } // End of DO block
          // INITWALK = INITWALK + 1; (1416)
          {
            int32_t numberRHS
                = (int32_t)(xadd (COREHALFWORD (mSTRUCTURE_WALKxINITWALK), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSTRUCTURE_WALKxINITWALK, bitRHS);
            bitRHS->inUse = 0;
          }
          // IF (SYT_FLAGS(INITOP) & NAME_FLAG) ~= 0 THEN (1417)
          if (1
              & (xNEQ (xAND (getFIXED (
                                 getFIXED (mSYM_TAB)
                                 + 34 * (COREHALFWORD (mSTRUCTURE_WALKxINITOP))
                                 + 8 + 4 * (0)),
                             getFIXED (mNAME_FLAG)),
                       0)))
            // DO; (1418)
            {
            rs1s1s3:;
              // N = 1; (1419)
              {
                int32_t numberRHS = (int32_t)(1);
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mSTRUCTURE_WALKxN, bitRHS);
                bitRHS->inUse = 0;
              }
              // CELL = GET_CELL(SHL(TEMPL_INX+5,1),ADDR(VMEM_H),RESV); (1420)
              {
                int32_t numberRHS = (int32_t)((
                    putFIXED (mGET_CELLxCELL_SIZE,
                              SHL (xadd (COREHALFWORD (mTEMPL_INX), 5), 1)),
                    putFIXED (mGET_CELLxBVAR,
                              ADDR ("VMEM_H", 0x80000000, NULL, 0)),
                    putBITp (8, mGET_CELLxFLAGS, getBIT (8, mRESV)),
                    GET_CELL (0)));
                putFIXED (mSTRUCTURE_WALKxCELL, numberRHS);
              }
              // IF TERM_LIST_HEAD = 0 THEN (1421)
              if (1 & (xEQ (getFIXED (mTERM_LIST_HEAD), 0)))
                // DO; (1422)
                {
                rs1s1s3s1:;
                  // TERM_LIST_HEAD = CELL; (1423)
                  {
                    int32_t numberRHS
                        = (int32_t)(getFIXED (mSTRUCTURE_WALKxCELL));
                    putFIXED (mTERM_LIST_HEAD, numberRHS);
                  }
                  // COREWORD(ADDR(NODE_F)) = VMEM_LOC_ADDR; (1424)
                  {
                    int32_t numberRHS = (int32_t)(getFIXED (mVMEM_LOC_ADDR));
                    COREWORD2 (
                        ADDR ("STRUCTURE_WALKxNODE_F", 0x80000000, NULL, 0),
                        numberRHS);
                  }
                es1s1s3s1:;
                } // End of DO block
              // ELSE (1425)
              else
                // DO; (1426)
                {
                rs1s1s3s2:;
                  // NODE_F(1) = CELL; (1427)
                  {
                    int32_t numberRHS
                        = (int32_t)(getFIXED (mSTRUCTURE_WALKxCELL));
                    putFIXED (getFIXED (mSTRUCTURE_WALKxNODE_F) + 4 * (1),
                              numberRHS);
                  }
                  // COREWORD(ADDR(NODE_F)) = VMEM_LOC_ADDR; (1428)
                  {
                    int32_t numberRHS = (int32_t)(getFIXED (mVMEM_LOC_ADDR));
                    COREWORD2 (
                        ADDR ("STRUCTURE_WALKxNODE_F", 0x80000000, NULL, 0),
                        numberRHS);
                  }
                  // CALL PTR_LOCATE(OLD_CELL,RELS); (1429)
                  {
                    putFIXED (mPTR_LOCATExPTR,
                              getFIXED (mSTRUCTURE_WALKxOLD_CELL));
                    putBITp (8, mPTR_LOCATExFLAGS, getBIT (8, mRELS));
                    PTR_LOCATE (0);
                  }
                es1s1s3s2:;
                } // End of DO block
              // VMEM_H(0) = INITWALK; (1430)
              {
                descriptor_t *bitRHS = getBIT (16, mSTRUCTURE_WALKxINITWALK);
                putBIT (16, getFIXED (mVMEM_H) + 2 * (0), bitRHS);
                bitRHS->inUse = 0;
              }
              // VMEM_H(1) = TEMPL_INX + 1; (1431)
              {
                int32_t numberRHS
                    = (int32_t)(xadd (COREHALFWORD (mTEMPL_INX), 1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, getFIXED (mVMEM_H) + 2 * (1), bitRHS);
                bitRHS->inUse = 0;
              }
              // DO I = 1 TO TEMPL_INX; (1432)
              {
                int32_t from31, to31, by31;
                from31 = 1;
                to31 = bitToFixed (getBIT (16, mTEMPL_INX));
                by31 = 1;
                for (putBIT (16, mSTRUCTURE_WALKxI, fixedToBit (16, from31));
                     bitToFixed (getBIT (16, mSTRUCTURE_WALKxI)) <= to31;
                     putBIT (16, mSTRUCTURE_WALKxI,
                             fixedToBit (16, bitToFixed (getBIT (
                                                 16, mSTRUCTURE_WALKxI))
                                                 + by31)))
                  {
                    // VMEM_H(I+3) = TEMPL_LIST(I); (1433)
                    {
                      descriptor_t *bitRHS = getBIT (
                          16,
                          mTEMPL_LIST + 2 * COREHALFWORD (mSTRUCTURE_WALKxI));
                      putBIT (
                          16,
                          getFIXED (mVMEM_H)
                              + 2
                                    * (xadd (COREHALFWORD (mSTRUCTURE_WALKxI),
                                             3)),
                          bitRHS);
                      bitRHS->inUse = 0;
                    }
                  }
              } // End of DO for-loop block
              // VMEM_H(TEMPL_INX+4) = INITOP; (1434)
              {
                descriptor_t *bitRHS = getBIT (16, mSTRUCTURE_WALKxINITOP);
                putBIT (16,
                        getFIXED (mVMEM_H)
                            + 2 * (xadd (COREHALFWORD (mTEMPL_INX), 4)),
                        bitRHS);
                bitRHS->inUse = 0;
              }
              // OLD_CELL = CELL; (1435)
              {
                int32_t numberRHS = (int32_t)(getFIXED (mSTRUCTURE_WALKxCELL));
                putFIXED (mSTRUCTURE_WALKxOLD_CELL, numberRHS);
              }
            es1s1s3:;
            } // End of DO block
          // ELSE (1436)
          else
            // N = LUMP_ARRAYSIZE(INITOP) * LUMP_TERMINALSIZE(INITOP); (1437)
            {
              int32_t numberRHS = (int32_t)(xmultiply (
                  (putBITp (16, mLUMP_ARRAYSIZExOP,
                            getBIT (16, mSTRUCTURE_WALKxINITOP)),
                   LUMP_ARRAYSIZE (0)),
                  (putBITp (16, mLUMP_TERMINALSIZExOP,
                            getBIT (16, mSTRUCTURE_WALKxINITOP)),
                   LUMP_TERMINALSIZE (0))));
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (16, mSTRUCTURE_WALKxN, bitRHS);
              bitRHS->inUse = 0;
            }
        es1s1:;
        } // End of DO block
      // ELSE (1438)
      else
        // DO; (1439)
        {
        rs1s2:;
          // N = N - 1; (1440)
          {
            int32_t numberRHS
                = (int32_t)(xsubtract (COREHALFWORD (mSTRUCTURE_WALKxN), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSTRUCTURE_WALKxN, bitRHS);
            bitRHS->inUse = 0;
          }
          // INITWALK = INITWALK + 1; (1441)
          {
            int32_t numberRHS
                = (int32_t)(xadd (COREHALFWORD (mSTRUCTURE_WALKxINITWALK), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSTRUCTURE_WALKxINITWALK, bitRHS);
            bitRHS->inUse = 0;
          }
        es1s2:;
        } // End of DO block
    }     // End of DO WHILE block
  {
    reentryGuard = 0;
    return 0;
  }
}
