/*
  File SET_ARRAYNESS.c generated by XCOM-I, 2024-08-09 12:41:08.
*/

#include "runtimeC.h"

descriptor_t *
SET_ARRAYNESS (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (descriptor_t *)0;
    }
  reentryGuard = guardReentry (reentryGuard, "SET_ARRAYNESS");
  // RET,RET1,DSUB_FLAG = 0; (2265)
  {
    int32_t numberRHS = (int32_t)(0);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (8, mSET_ARRAYNESSxRET1, bitRHS);
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (8, mSET_ARRAYNESSxDSUB_FLAG, bitRHS);
    bitRHS->inUse = 0;
  }
  // PTR = INX - 1; (2266)
  {
    int32_t numberRHS
        = (int32_t)(xsubtract (COREHALFWORD (mSET_ARRAYNESSxINX), 1));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mSET_ARRAYNESSxPTR, bitRHS);
    bitRHS->inUse = 0;
  }
  // TEMP = NODE(INX) &  65535; (2267)
  {
    int32_t numberRHS = (int32_t)(xAND (
        getFIXED (mNODE + 4 * COREHALFWORD (mSET_ARRAYNESSxINX)), 65535));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mSET_ARRAYNESSxTEMP, bitRHS);
    bitRHS->inUse = 0;
  }
  // IF TEMP = DSUB THEN (2268)
  if (1 & (xEQ (COREHALFWORD (mSET_ARRAYNESSxTEMP), COREHALFWORD (mDSUB))))
    // DSUB_FLAG = TRUE; (2269)
    {
      int32_t numberRHS = (int32_t)(1);
      descriptor_t *bitRHS;
      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
      putBIT (8, mSET_ARRAYNESSxDSUB_FLAG, bitRHS);
      bitRHS->inUse = 0;
    }
  // IF TEMP = EXTN THEN (2270)
  if (1 & (xEQ (COREHALFWORD (mSET_ARRAYNESSxTEMP), COREHALFWORD (mEXTN))))
    // PTR = PTR - 1; (2271)
    {
      int32_t numberRHS
          = (int32_t)(xsubtract (COREHALFWORD (mSET_ARRAYNESSxPTR), 1));
      descriptor_t *bitRHS;
      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
      putBIT (16, mSET_ARRAYNESSxPTR, bitRHS);
      bitRHS->inUse = 0;
    }
  // DO WHILE NODE(PTR) ~= END_OF_NODE; (2272)
  while (1
         & (xNEQ (getFIXED (mNODE + 4 * COREHALFWORD (mSET_ARRAYNESSxPTR)),
                  getFIXED (mEND_OF_NODE))))
    {
      // RET = RET | RET1; (2273)
      {
        int32_t numberRHS = (int32_t)(xOR (BYTE0 (mSET_ARRAYNESSxRET),
                                           BYTE0 (mSET_ARRAYNESSxRET1)));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
        bitRHS->inUse = 0;
      }
      // RET1 = ARRAYED_ELT(NODE(PTR),NODE2(PTR),DSUB_FLAG); (2274)
      {
        descriptor_t *bitRHS
            = (putFIXED (
                   mARRAYED_ELTxNODE_WORD,
                   getFIXED (mNODE + 4 * COREHALFWORD (mSET_ARRAYNESSxPTR))),
               putBITp (
                   16, mARRAYED_ELTxNODE2_WORD,
                   getBIT (16,
                           mNODE2 + 2 * COREHALFWORD (mSET_ARRAYNESSxPTR))),
               putBITp (8, mARRAYED_ELTxDSUB_FLAG,
                        getBIT (8, mSET_ARRAYNESSxDSUB_FLAG)),
               ARRAYED_ELT (0));
        putBIT (8, mSET_ARRAYNESSxRET1, bitRHS);
        bitRHS->inUse = 0;
      }
      // PTR = PTR - 1; (2275)
      {
        int32_t numberRHS
            = (int32_t)(xsubtract (COREHALFWORD (mSET_ARRAYNESSxPTR), 1));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mSET_ARRAYNESSxPTR, bitRHS);
        bitRHS->inUse = 0;
      }
    } // End of DO WHILE block
  // IF TEMP = DSUB THEN (2276)
  if (1 & (xEQ (COREHALFWORD (mSET_ARRAYNESSxTEMP), COREHALFWORD (mDSUB))))
    // IF TYPE(NODE(PTR + 1)) =  12 | TYPE(NODE(PTR + 1)) =  3 THEN (2277)
    if (1
        & (xOR (
            xEQ (bitToFixed ((
                     putFIXED (mTYPExCSE_WORD,
                               getFIXED (mNODE
                                         + 4
                                               * xadd (COREHALFWORD (
                                                           mSET_ARRAYNESSxPTR),
                                                       1))),
                     TYPE (0))),
                 12),
            xEQ (bitToFixed ((
                     putFIXED (mTYPExCSE_WORD,
                               getFIXED (mNODE
                                         + 4
                                               * xadd (COREHALFWORD (
                                                           mSET_ARRAYNESSxPTR),
                                                       1))),
                     TYPE (0))),
                 3))))
      // IF RET1 = 1 THEN (2278)
      if (1 & (xEQ (BYTE0 (mSET_ARRAYNESSxRET1), 1)))
        // DO; (2279)
        {
        rs2:;
          // RET = RET | RET1; (2280)
          {
            int32_t numberRHS = (int32_t)(xOR (BYTE0 (mSET_ARRAYNESSxRET),
                                               BYTE0 (mSET_ARRAYNESSxRET1)));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
            bitRHS->inUse = 0;
          }
          // GOTO EXITT; (2281)
          goto EXITT;
        es2:;
        } // End of DO block
      // ELSE (2282)
      else
        // IF RET1 = 2 THEN (2283)
        if (1 & (xEQ (BYTE0 (mSET_ARRAYNESSxRET1), 2)))
          // DO; (2284)
          {
          rs3:;
            // RET = RET|RET1; (2285)
            {
              int32_t numberRHS = (int32_t)(xOR (BYTE0 (mSET_ARRAYNESSxRET),
                                                 BYTE0 (mSET_ARRAYNESSxRET1)));
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
              bitRHS->inUse = 0;
            }
            // GOTO EXITT; (2286)
            goto EXITT;
          es3:;
          } // End of DO block
        // ELSE (2287)
        else
          // RET1 = 1; (2288)
          {
            int32_t numberRHS = (int32_t)(1);
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (8, mSET_ARRAYNESSxRET1, bitRHS);
            bitRHS->inUse = 0;
          }
  // IF RET1 & ~RET THEN (2289)
  if (1
      & (xAND (BYTE0 (mSET_ARRAYNESSxRET1),
               xNOT (BYTE0 (mSET_ARRAYNESSxRET)))))
    // DO; (2290)
    {
    rs4:;
      // IF TEMP = DSUB OR TEMP = TSUB THEN (2291)
      if (1
          & (xOR (
              xEQ (COREHALFWORD (mSET_ARRAYNESSxTEMP), COREHALFWORD (mDSUB)),
              xEQ (COREHALFWORD (mSET_ARRAYNESSxTEMP), COREHALFWORD (mTSUB)))))
        // DO; (2292)
        {
        rs4s1:;
          // RET = (RET1 | RET) &  2; (2293)
          {
            int32_t numberRHS = (int32_t)(xAND (
                xOR (BYTE0 (mSET_ARRAYNESSxRET1), BYTE0 (mSET_ARRAYNESSxRET)),
                2));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
            bitRHS->inUse = 0;
          }
          // PTR = NODE(PTR - 1) &  65535; (2294)
          {
            int32_t numberRHS = (int32_t)(xAND (
                getFIXED (
                    mNODE
                    + 4 * xsubtract (COREHALFWORD (mSET_ARRAYNESSxPTR), 1)),
                65535));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSET_ARRAYNESSxPTR, bitRHS);
            bitRHS->inUse = 0;
          }
          // DO FOR DSUB_INX = PTR + 2 TO LAST_OPERAND(PTR); (2295)
          {
            int32_t from52, to52, by52;
            from52 = xadd (COREHALFWORD (mSET_ARRAYNESSxPTR), 2);
            to52 = bitToFixed ((putBITp (16, mLAST_OPERANDxPTR,
                                         getBIT (16, mSET_ARRAYNESSxPTR)),
                                LAST_OPERAND (0)));
            by52 = 1;
            for (putBIT (16, mSET_ARRAYNESSxDSUB_INX, fixedToBit (16, from52));
                 bitToFixed (getBIT (16, mSET_ARRAYNESSxDSUB_INX)) <= to52;
                 putBIT (16, mSET_ARRAYNESSxDSUB_INX,
                         fixedToBit (16, bitToFixed (getBIT (
                                             16, mSET_ARRAYNESSxDSUB_INX))
                                             + by52)))
              {
                // TEMP = SHR(OPR(DSUB_INX),8) &  15; (2296)
                {
                  int32_t numberRHS = (int32_t)(xAND (
                      SHR (getFIXED (
                               mOPR
                               + 4 * COREHALFWORD (mSET_ARRAYNESSxDSUB_INX)),
                           8),
                      15));
                  descriptor_t *bitRHS;
                  bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                  putBIT (16, mSET_ARRAYNESSxTEMP, bitRHS);
                  bitRHS->inUse = 0;
                }
                // IF TEMP < 4 THEN (2297)
                if (1 & (xLT (COREHALFWORD (mSET_ARRAYNESSxTEMP), 4)))
                  // GO TO EXITT; (2298)
                  goto EXITT;
                // IF (TEMP &  3) ~= 1 THEN (2299)
                if (1
                    & (xNEQ (xAND (COREHALFWORD (mSET_ARRAYNESSxTEMP), 3), 1)))
                  // DO; (2300)
                  {
                  rs4s1s1s1:;
                    // RET = RET | 1; (2301)
                    {
                      int32_t numberRHS
                          = (int32_t)(xOR (BYTE0 (mSET_ARRAYNESSxRET), 1));
                      descriptor_t *bitRHS;
                      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                      putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
                      bitRHS->inUse = 0;
                    }
                    // GO TO EXITT; (2302)
                    goto EXITT;
                  es4s1s1s1:;
                  } // End of DO block
              }
          } // End of DO for-loop block
        es4s1:;
        } // End of DO block
      // ELSE (2303)
      else
        // RET = RET | RET1; (2304)
        {
          int32_t numberRHS = (int32_t)(xOR (BYTE0 (mSET_ARRAYNESSxRET),
                                             BYTE0 (mSET_ARRAYNESSxRET1)));
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
          bitRHS->inUse = 0;
        }
    es4:;
    } // End of DO block
  // ELSE (2305)
  else
    // RET = RET | RET1; (2306)
    {
      int32_t numberRHS = (int32_t)(xOR (BYTE0 (mSET_ARRAYNESSxRET),
                                         BYTE0 (mSET_ARRAYNESSxRET1)));
      descriptor_t *bitRHS;
      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
      putBIT (8, mSET_ARRAYNESSxRET, bitRHS);
      bitRHS->inUse = 0;
    }
// EXITT: (2307)
EXITT:
  // NODE(INX) = NODE(INX) & ~DA_MASK | SHL(RET,29); (2308)
  {
    int32_t numberRHS = (int32_t)(xOR (
        xAND (getFIXED (mNODE + 4 * COREHALFWORD (mSET_ARRAYNESSxINX)),
              xNOT (getFIXED (mDA_MASK))),
        SHL (BYTE0 (mSET_ARRAYNESSxRET), 29)));
    putFIXED (mNODE + 4 * (COREHALFWORD (mSET_ARRAYNESSxINX)), numberRHS);
  }
  // IF I_TRACE THEN (2309)
  if (1 & (bitToFixed (getBIT (8, mSTACK_TRACE))))
    // OUTPUT = 'SET_ARRAYNESS(' || INX || '):  ' || RET; (2310)
    {
      descriptor_t *stringRHS;
      stringRHS = xsCAT (
          xsCAT (xsCAT (cToDescriptor (NULL, "SET_ARRAYNESS("),
                        bitToCharacter (getBIT (16, mSET_ARRAYNESSxINX))),
                 cToDescriptor (NULL, "):  ")),
          bitToCharacter (getBIT (8, mSET_ARRAYNESSxRET)));
      OUTPUT (0, stringRHS);
      stringRHS->inUse = 0;
    }
  // RETURN RET; (2311)
  {
    reentryGuard = 0;
    return getBIT (8, mSET_ARRAYNESSxRET);
  }
}
