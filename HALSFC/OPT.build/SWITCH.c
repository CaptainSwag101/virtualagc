/*
  File SWITCH.c generated by XCOM-I, 2024-08-09 12:38:53.
*/

#include "runtimeC.h"

int32_t
SWITCH (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "SWITCH");
  // IF TRACE THEN (1956)
  if (1 & (bitToFixed (getBIT (8, mTRACE))))
    // OUTPUT = 'SWITCH: '||ORIG||' TO '||PTR; (1957)
    {
      descriptor_t *stringRHS;
      stringRHS
          = xsCAT (xsCAT (xsCAT (cToDescriptor (NULL, "SWITCH: "),
                                 bitToCharacter (getBIT (16, mSWITCHxORIG))),
                          cToDescriptor (NULL, " TO ")),
                   bitToCharacter (getBIT (16, mSWITCHxPTR)));
      OUTPUT (0, stringRHS);
      stringRHS->inUse = 0;
    }
  // IF ORIG = PTR THEN (1958)
  if (1 & (xEQ (COREHALFWORD (mSWITCHxORIG), COREHALFWORD (mSWITCHxPTR))))
    // RETURN; (1959)
    {
      reentryGuard = 0;
      return 0;
    }
  // TMP = OPR(ORIG); (1960)
  {
    int32_t numberRHS
        = (int32_t)(getFIXED (mOPR + 4 * COREHALFWORD (mSWITCHxORIG)));
    putFIXED (mTMP, numberRHS);
  }
  // TEMP = FLAG(ORIG); (1961)
  {
    descriptor_t *bitRHS = getBIT (8, mFLAG + 1 * COREHALFWORD (mSWITCHxORIG));
    putBIT (16, mSWITCHxTEMP, bitRHS);
    bitRHS->inUse = 0;
  }
  // OPR(ORIG) = OPR(PTR); (1962)
  {
    int32_t numberRHS
        = (int32_t)(getFIXED (mOPR + 4 * COREHALFWORD (mSWITCHxPTR)));
    putFIXED (mOPR + 4 * (COREHALFWORD (mSWITCHxORIG)), numberRHS);
  }
  // FLAG(ORIG) = FLAG(PTR); (1963)
  {
    descriptor_t *bitRHS = getBIT (8, mFLAG + 1 * COREHALFWORD (mSWITCHxPTR));
    putBIT (8, mFLAG + 1 * (COREHALFWORD (mSWITCHxORIG)), bitRHS);
    bitRHS->inUse = 0;
  }
  // OPR(PTR) = TMP; (1964)
  {
    int32_t numberRHS = (int32_t)(getFIXED (mTMP));
    putFIXED (mOPR + 4 * (COREHALFWORD (mSWITCHxPTR)), numberRHS);
  }
  // FLAG(PTR) = TEMP; (1965)
  {
    descriptor_t *bitRHS = getBIT (16, mSWITCHxTEMP);
    putBIT (8, mFLAG + 1 * (COREHALFWORD (mSWITCHxPTR)), bitRHS);
    bitRHS->inUse = 0;
  }
  // IF HALMAT_FLAG(ORIG) THEN (1966)
  if (1
      & (bitToFixed (
          (putBITp (16, mHALMAT_FLAGxPTR, getBIT (16, mSWITCHxORIG)),
           HALMAT_FLAG (0)))))
    // CALL ENTER (ORIG); (1967)
    {
      putBITp (16, mENTERxPTR, getBIT (16, mSWITCHxORIG));
      ENTER (0);
    }
  // IF HALMAT_FLAG(PTR) THEN (1968)
  if (1
      & (bitToFixed ((putBITp (16, mHALMAT_FLAGxPTR, getBIT (16, mSWITCHxPTR)),
                      HALMAT_FLAG (0)))))
    // CALL ENTER(PTR); (1969)
    {
      putBITp (16, mENTERxPTR, getBIT (16, mSWITCHxPTR));
      ENTER (0);
    }
  // IF VAC_OR_XPT(ORIG) THEN (1970)
  if (1
      & (bitToFixed ((putBITp (16, mVAC_OR_XPTxPTR, getBIT (16, mSWITCHxORIG)),
                      VAC_OR_XPT (0)))))
    // DO; (1971)
    {
    rs1:;
      // REF = SHR(OPR(ORIG),16); (1972)
      {
        int32_t numberRHS = (int32_t)(SHR (
            getFIXED (mOPR + 4 * COREHALFWORD (mSWITCHxORIG)), 16));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mSWITCHxREF, bitRHS);
        bitRHS->inUse = 0;
      }
      // IF HALMAT_FLAG(ORIG) THEN (1973)
      if (1
          & (bitToFixed (
              (putBITp (16, mHALMAT_FLAGxPTR, getBIT (16, mSWITCHxORIG)),
               HALMAT_FLAG (0)))))
        // REF = NODE(REF) &  65535; (1974)
        {
          int32_t numberRHS = (int32_t)(xAND (
              getFIXED (mNODE + 4 * COREHALFWORD (mSWITCHxREF)), 65535));
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (16, mSWITCHxREF, bitRHS);
          bitRHS->inUse = 0;
        }
      // IF REF > ORIG THEN (1975)
      if (1 & (xGT (COREHALFWORD (mSWITCHxREF), COREHALFWORD (mSWITCHxORIG))))
        // DO; (1976)
        {
        rs1s1:;
          // LOW = LAST_OP(ORIG); (1977)
          {
            int32_t numberRHS = (int32_t)((
                putBITp (16, mLAST_OPxPTR, getBIT (16, mSWITCHxORIG)),
                LAST_OP (0)));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSWITCHxLOW, bitRHS);
            bitRHS->inUse = 0;
          }
          // REF = LAST_OP(REF); (1978)
          {
            int32_t numberRHS = (int32_t)((
                putBITp (16, mLAST_OPxPTR, getBIT (16, mSWITCHxREF)),
                LAST_OP (0)));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSWITCHxREF, bitRHS);
            bitRHS->inUse = 0;
          }
          // ORIG_HIGH,HIGH = LOW + 1; (1979)
          {
            int32_t numberRHS
                = (int32_t)(xadd (COREHALFWORD (mSWITCHxLOW), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSWITCHxORIG_HIGH, bitRHS);
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSWITCHxHIGH, bitRHS);
            bitRHS->inUse = 0;
          }
          // TEMP = NEXT_FLAG(HIGH); (1980)
          {
            int32_t numberRHS = (int32_t)((
                putBITp (16, mNEXT_FLAGxPTR, getBIT (16, mSWITCHxHIGH)),
                NEXT_FLAG (0)));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mSWITCHxTEMP, bitRHS);
            bitRHS->inUse = 0;
          }
          // DO WHILE TEMP < REF; (1981)
          while (1
                 & (xLT (COREHALFWORD (mSWITCHxTEMP),
                         COREHALFWORD (mSWITCHxREF))))
            {
              // HIGH = TEMP; (1982)
              {
                descriptor_t *bitRHS = getBIT (16, mSWITCHxTEMP);
                putBIT (16, mSWITCHxHIGH, bitRHS);
                bitRHS->inUse = 0;
              }
              // TEMP = NEXT_FLAG(HIGH + 1); (1983)
              {
                int32_t numberRHS = (int32_t)((
                    putBITp (
                        16, mNEXT_FLAGxPTR,
                        fixedToBit (32, (int32_t)(xadd (
                                            COREHALFWORD (mSWITCHxHIGH), 1)))),
                    NEXT_FLAG (0)));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mSWITCHxTEMP, bitRHS);
                bitRHS->inUse = 0;
              }
            } // End of DO WHILE block
          // IF HIGH = ORIG_HIGH THEN (1984)
          if (1
              & (xEQ (COREHALFWORD (mSWITCHxHIGH),
                      COREHALFWORD (mSWITCHxORIG_HIGH))))
            // HIGH = LOW + NO_OPERANDS(LOW) + 1; (1985)
            {
              int32_t numberRHS = (int32_t)(xadd (
                  xadd (COREHALFWORD (mSWITCHxLOW),
                        bitToFixed ((putBITp (16, mNO_OPERANDSxPTR,
                                              getBIT (16, mSWITCHxLOW)),
                                     NO_OPERANDS (0)))),
                  1));
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (16, mSWITCHxHIGH, bitRHS);
              bitRHS->inUse = 0;
            }
          // ELSE (1986)
          else
            // HIGH = HIGH + NO_OPERANDS(HIGH) + 1; (1987)
            {
              int32_t numberRHS = (int32_t)(xadd (
                  xadd (COREHALFWORD (mSWITCHxHIGH),
                        bitToFixed ((putBITp (16, mNO_OPERANDSxPTR,
                                              getBIT (16, mSWITCHxHIGH)),
                                     NO_OPERANDS (0)))),
                  1));
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (16, mSWITCHxHIGH, bitRHS);
              bitRHS->inUse = 0;
            }
          // CALL MOVE_LIMB(LOW,HIGH,REF - HIGH + NO_OPERANDS(REF) + 1); (1988)
          {
            putBITp (16, mMOVE_LIMBxLOW, getBIT (16, mSWITCHxLOW));
            putBITp (16, mMOVE_LIMBxHIGH, getBIT (16, mSWITCHxHIGH));
            putBITp (
                16, mMOVE_LIMBxBIG,
                fixedToBit (
                    32,
                    (int32_t)(xadd (
                        xadd (xsubtract (COREHALFWORD (mSWITCHxREF),
                                         COREHALFWORD (mSWITCHxHIGH)),
                              bitToFixed ((putBITp (16, mNO_OPERANDSxPTR,
                                                    getBIT (16, mSWITCHxREF)),
                                           NO_OPERANDS (0)))),
                        1))));
            MOVE_LIMB (0);
          }
        es1s1:;
        } // End of DO block
    es1:;
    } // End of DO block
  {
    reentryGuard = 0;
    return 0;
  }
}
