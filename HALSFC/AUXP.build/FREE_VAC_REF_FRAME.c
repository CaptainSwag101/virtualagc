/*
  File FREE_VAC_REF_FRAME.c generated by XCOM-I, 2024-08-09 12:39:13.
*/

#include "runtimeC.h"

int32_t
FREE_VAC_REF_FRAME (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "FREE_VAC_REF_FRAME");
  // IF POOL_INDEX = 0 THEN (1036)
  if (1 & (xEQ (COREHALFWORD (mFREE_VAC_REF_FRAMExPOOL_INDEX), 0)))
    // RETURN; (1037)
    {
      reentryGuard = 0;
      return 0;
    }
  // MAP# = POOL_INDEX / (VAC_REF_POOL_FRAME_SIZE + 1); (1038)
  {
    int32_t numberRHS = (int32_t)(xdivide (
        COREHALFWORD (mFREE_VAC_REF_FRAMExPOOL_INDEX),
        xadd (COREHALFWORD (mVAC_REF_POOL_FRAME_SIZE), 1)));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mFREE_VAC_REF_FRAMExMAPp, bitRHS);
    bitRHS->inUse = 0;
  }
  // TEMP_PTR = SHR(MAP#, 5); (1039)
  {
    int32_t numberRHS
        = (int32_t)(SHR (COREHALFWORD (mFREE_VAC_REF_FRAMExMAPp), 5));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mFREE_VAC_REF_FRAMExTEMP_PTR, bitRHS);
    bitRHS->inUse = 0;
  }
  // VAC_REF_POOL_MAP(TEMP_PTR) = VAC_REF_POOL_MAP(TEMP_PTR) &
  // (~MAP_INDICES(MAP# &  31)); (1040)
  {
    int32_t numberRHS = (int32_t)(xAND (
        COREWORD (getFIXED (mV_MAP_VAR)
                  + 4 * (COREHALFWORD (mFREE_VAC_REF_FRAMExTEMP_PTR)) + 0
                  + 4 * (0)),
        xNOT (getFIXED (
            mMAP_INDICES
            + 4 * xAND (COREHALFWORD (mFREE_VAC_REF_FRAMExMAPp), 31)))));
    putBIT (32,
            getFIXED (mV_MAP_VAR)
                + 4 * (COREHALFWORD (mFREE_VAC_REF_FRAMExTEMP_PTR)) + 0
                + 4 * (0),
            fixedToBit (32, numberRHS));
  }
  {
    reentryGuard = 0;
    return 0;
  }
}
