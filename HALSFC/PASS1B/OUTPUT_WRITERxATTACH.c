/*
  File OUTPUT_WRITERxATTACH.c generated by XCOM-I, 2024-08-08 04:33:34.
*/

#include "runtimeC.h"

descriptor_t *
OUTPUT_WRITERxATTACH (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (descriptor_t *)0;
    }
  reentryGuard = guardReentry (reentryGuard, "OUTPUT_WRITERxATTACH");
  // CURRENT_ERROR_PTR = MAX(CURRENT_ERROR_PTR, ERROR_PTR(PNTR)); (2171)
  {
    int32_t numberRHS = (int32_t)((
        putFIXED (mMAXxI, COREHALFWORD (mOUTPUT_WRITERxCURRENT_ERROR_PTR)),
        putFIXED (
            mMAXxJ,
            COREHALFWORD (mERROR_PTR
                          + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR))),
        MAX (0)));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mOUTPUT_WRITERxCURRENT_ERROR_PTR, bitRHS);
    bitRHS->inUse = 0;
  }
  // IF STMT_STACK(PNTR) = 0 THEN (2172)
  if (1
      & (xEQ (COREHALFWORD (mSTMT_STACK
                            + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
              0)))
    // DO; (2173)
    {
    rs1:;
      // SPACE_NEEDED = 0; (2174)
      {
        int32_t numberRHS = (int32_t)(0);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mOUTPUT_WRITERxSPACE_NEEDED, bitRHS);
        bitRHS->inUse = 0;
      }
      // RETURN ''; (2175)
      {
        reentryGuard = 0;
        return cToDescriptor (NULL, "");
      }
    es1:;
    } // End of DO block
  // IF (GRAMMAR_FLAGS(PNTR) & PRINT_FLAG) = 0 THEN (2176)
  if (1
      & (xEQ (
          xAND (COREHALFWORD (mGRAMMAR_FLAGS
                              + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
                COREHALFWORD (mPRINT_FLAG)),
          0)))
    // IF ~RECOVERING THEN (2177)
    if (1 & (xNOT (BYTE0 (mRECOVERING))))
      // RETURN ''; (2178)
      {
        reentryGuard = 0;
        return cToDescriptor (NULL, "");
      }
  // GRAMMAR_FLAGS(PNTR) = GRAMMAR_FLAGS(PNTR) & PRINT_FLAG_OFF; (2179)
  {
    int32_t numberRHS = (int32_t)(xAND (
        COREHALFWORD (mGRAMMAR_FLAGS
                      + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
        COREHALFWORD (mPRINT_FLAG_OFF)));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16,
            mGRAMMAR_FLAGS + 2 * (COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
            bitRHS);
    bitRHS->inUse = 0;
  }
  // SPACE_NEEDED = 1; (2180)
  {
    int32_t numberRHS = (int32_t)(1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mOUTPUT_WRITERxSPACE_NEEDED, bitRHS);
    bitRHS->inUse = 0;
  }
  // IF MACRO_WRITTEN THEN (2181)
  if (1 & (bitToFixed (getBIT (1, mOUTPUT_WRITERxMACRO_WRITTEN))))
    // DO; (2182)
    {
    rs2:;
      // MACRO_WRITTEN = FALSE; (2183)
      {
        int32_t numberRHS = (int32_t)(0);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (1, mOUTPUT_WRITERxMACRO_WRITTEN, bitRHS);
        bitRHS->inUse = 0;
      }
      // IF LAST_SPACE = 2 THEN (2184)
      if (1 & (xEQ (COREHALFWORD (mLAST_SPACE), 2)))
        // IF SHR(TOKEN_FLAGS(PNTR), 6) = 0 THEN (2185)
        if (1
            & (xEQ (SHR (COREHALFWORD (
                             mTOKEN_FLAGS
                             + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
                         6),
                    0)))
          // IF STMT_STACK(PNTR) = LEFT_PAREN THEN (2186)
          if (1
              & (xEQ (COREHALFWORD (
                          mSTMT_STACK
                          + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
                      getFIXED (mLEFT_PAREN))))
            // GO TO PARAM_MACRO; (2187)
            goto PARAM_MACRO;
      // LAST_SPACE = 0; (2188)
      {
        int32_t numberRHS = (int32_t)(0);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mLAST_SPACE, bitRHS);
        bitRHS->inUse = 0;
      }
    es2:;
    } // End of DO block
// PARAM_MACRO: (2189)
PARAM_MACRO:
  // L = SPACE_FLAGS(STMT_STACK(PNTR) + OFFSET); (2190)
  {
    descriptor_t *bitRHS = getBIT (
        8,
        mSPACE_FLAGS
            + 1
                  * xadd (COREHALFWORD (
                              mSTMT_STACK
                              + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
                          COREHALFWORD (mOUTPUT_WRITERxATTACHxOFFSET)));
    int32_t numberRHS;
    numberRHS = bitToFixed (bitRHS);
    putFIXED (mL, numberRHS);
    bitRHS->inUse = 0;
  }
  // I = SHR(L, 4) + LAST_SPACE; (2191)
  {
    int32_t numberRHS
        = (int32_t)(xadd (SHR (getFIXED (mL), 4), COREHALFWORD (mLAST_SPACE)));
    putFIXED (mI, numberRHS);
  }
  // IF I ~> 4 THEN (2192)
  if (1 & (xLE (getFIXED (mI), 4)))
    // IF I > 1 THEN (2193)
    if (1 & (xGT (getFIXED (mI), 1)))
      // SPACE_NEEDED = 0; (2194)
      {
        int32_t numberRHS = (int32_t)(0);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mOUTPUT_WRITERxSPACE_NEEDED, bitRHS);
        bitRHS->inUse = 0;
      }
  // IF SHR(TOKEN_FLAGS(PNTR), 5) THEN (2195)
  if (1
      & (SHR (COREHALFWORD (mTOKEN_FLAGS
                            + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
              5)))
    // LAST_SPACE = 2; (2196)
    {
      int32_t numberRHS = (int32_t)(2);
      descriptor_t *bitRHS;
      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
      putBIT (16, mLAST_SPACE, bitRHS);
      bitRHS->inUse = 0;
    }
  // ELSE (2197)
  else
    // LAST_SPACE = L &  15; (2198)
    {
      int32_t numberRHS = (int32_t)(xAND (getFIXED (mL), 15));
      descriptor_t *bitRHS;
      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
      putBIT (16, mLAST_SPACE, bitRHS);
      bitRHS->inUse = 0;
    }
  // IF SHR(TOKEN_FLAGS(PNTR), 6) = 0 THEN (2199)
  if (1
      & (xEQ (
          SHR (COREHALFWORD (mTOKEN_FLAGS
                             + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
               6),
          0)))
    // C = STRING(VOCAB_INDEX(STMT_STACK(PNTR))); (2200)
    {
      descriptor_t *stringRHS;
      stringRHS = getCHARACTER (
          mVOCAB_INDEX
          + 4
                * COREHALFWORD (
                    mSTMT_STACK
                    + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)));
      putCHARACTER (mC, stringRHS);
      stringRHS->inUse = 0;
    }
  // ELSE (2201)
  else
    // DO; (2202)
    {
    rs3:;
      // J = TOKEN_FLAGS(PNTR); (2203)
      {
        descriptor_t *bitRHS = getBIT (
            16, mTOKEN_FLAGS + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR));
        int32_t numberRHS;
        numberRHS = bitToFixed (bitRHS);
        putFIXED (mJ, numberRHS);
        bitRHS->inUse = 0;
      }
      // C = SAVE_BCD(SHR(J, 6)); (2204)
      {
        descriptor_t *stringRHS;
        stringRHS = getCHARACTER (mSAVE_BCD + 4 * SHR (getFIXED (mJ), 6));
        putCHARACTER (mC, stringRHS);
        stringRHS->inUse = 0;
      }
      // IF STMT_STACK(PNTR) = CHARACTER_STRING THEN (2205)
      if (1
          & (xEQ (
              COREHALFWORD (mSTMT_STACK
                            + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
              getFIXED (mCHARACTER_STRING))))
        // DO; (2206)
        {
        rs3s1:;
          // C(1), C(2) = ''; (2207)
          {
            descriptor_t *stringRHS;
            stringRHS = cToDescriptor (NULL, "");
            putCHARACTER (mC + 4 * (1), stringRHS);
            putCHARACTER (mC + 4 * (2), stringRHS);
            stringRHS->inUse = 0;
          }
          // IF (GRAMMAR_FLAGS(PNTR) & MACRO_ARG_FLAG)~=0 THEN (2208)
          if (1
              & (xNEQ (
                  xAND (COREHALFWORD (
                            mGRAMMAR_FLAGS
                            + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR)),
                        COREHALFWORD (mMACRO_ARG_FLAG)),
                  0)))
            // RETURN C; (2209)
            {
              reentryGuard = 0;
              return getCHARACTER (mC);
            }
          // S = C; (2210)
          {
            descriptor_t *stringRHS;
            stringRHS = getCHARACTER (mC);
            putCHARACTER (mS, stringRHS);
            stringRHS->inUse = 0;
          }
          // C = SQUOTE; (2211)
          {
            descriptor_t *stringRHS;
            stringRHS = getCHARACTER (mSQUOTE);
            putCHARACTER (mC, stringRHS);
            stringRHS->inUse = 0;
          }
          // I, J, K = 0; (2212)
          {
            int32_t numberRHS = (int32_t)(0);
            putFIXED (mI, numberRHS);
            putFIXED (mJ, numberRHS);
            putFIXED (mK, numberRHS);
          }
        // SEARCH: (2213)
        SEARCH:
          // DO WHILE (BYTE(S, I) ~= BYTE(SQUOTE)) & (I < LENGTH(S)); (2214)
          while (1
                 & (xAND (xNEQ (BYTE (getCHARACTER (mS), getFIXED (mI)),
                                BYTE1 (getCHARACTER (mSQUOTE))),
                          xLT (getFIXED (mI), LENGTH (getCHARACTER (mS))))))
            {
              // IF OFFSET ~= 0 THEN (2215)
              if (1 & (xNEQ (COREHALFWORD (mOUTPUT_WRITERxATTACHxOFFSET), 0)))
                // DO; (2216)
                {
                rs3s1s1s1:;
                  // IF (TRANS_OUT(BYTE(S, I)) &  255) ~= 0 THEN (2217)
                  if (1
                      & (xNEQ (
                          xAND (COREHALFWORD (mTRANS_OUT
                                              + 2
                                                    * BYTE (getCHARACTER (mS),
                                                            getFIXED (mI))),
                                255),
                          0)))
                    // DO; (2218)
                    {
                    rs3s1s1s1s1:;
                      // IF I ~= J THEN (2219)
                      if (1 & (xNEQ (getFIXED (mI), getFIXED (mJ))))
                        // CALL ADD(SUBSTR(S, J, I - J)); (2220)
                        {
                          putCHARACTERp (mOUTPUT_WRITERxATTACHxADDxSTRING,
                                         SUBSTR (getCHARACTER (mS),
                                                 getFIXED (mJ),
                                                 xsubtract (getFIXED (mI),
                                                            getFIXED (mJ))));
                          OUTPUT_WRITERxATTACHxADD (0);
                        }
                      // DO L = 0 TO SHR(TRANS_OUT(BYTE(S, I)), 8) &  255;
                      // (2221)
                      {
                        int32_t from45, to45, by45;
                        from45 = 0;
                        to45 = xAND (
                            SHR (COREHALFWORD (mTRANS_OUT
                                               + 2
                                                     * BYTE (getCHARACTER (mS),
                                                             getFIXED (mI))),
                                 8),
                            255);
                        by45 = 1;
                        for (putFIXED (mL, from45); getFIXED (mL) <= to45;
                             putFIXED (mL, getFIXED (mL) + by45))
                          {
                            // CALL ADD(STRING(ADDR(ESCP))); (2222)
                            {
                              putCHARACTERp (
                                  mOUTPUT_WRITERxATTACHxADDxSTRING,
                                  getCHARACTERd (ADDR (NULL, 0, "ESCP", 0)));
                              OUTPUT_WRITERxATTACHxADD (0);
                            }
                          }
                      } // End of DO for-loop block
                      // CALL ADD(STRING(ADDR(TRANS_OUT(BYTE(S, I))) + 1));
                      // (2223)
                      {
                        putCHARACTERp (
                            mOUTPUT_WRITERxATTACHxADDxSTRING,
                            getCHARACTERd (xadd (
                                ADDR (NULL, 0, "TRANS_OUT",
                                      BYTE (getCHARACTER (mS), getFIXED (mI))),
                                1)));
                        OUTPUT_WRITERxATTACHxADD (0);
                      }
                      // J, I = I + 1; (2224)
                      {
                        int32_t numberRHS = (int32_t)(xadd (getFIXED (mI), 1));
                        putFIXED (mJ, numberRHS);
                        putFIXED (mI, numberRHS);
                      }
                    es3s1s1s1s1:;
                    } // End of DO block
                  // ELSE (2225)
                  else
                    // I = I + 1; (2226)
                    {
                      int32_t numberRHS = (int32_t)(xadd (getFIXED (mI), 1));
                      putFIXED (mI, numberRHS);
                    }
                es3s1s1s1:;
                } // End of DO block
              // ELSE (2227)
              else
                // I = I + 1; (2228)
                {
                  int32_t numberRHS = (int32_t)(xadd (getFIXED (mI), 1));
                  putFIXED (mI, numberRHS);
                }
              if (0)
                {
                rs3s1s1:
                  continue;
                es3s1s1:
                  break;
                } // block labeled SEARCH
            }     // End of DO WHILE block
          // IF I ~= J THEN (2229)
          if (1 & (xNEQ (getFIXED (mI), getFIXED (mJ))))
            // CALL ADD(SUBSTR(S, J, I - J)); (2230)
            {
              putCHARACTERp (
                  mOUTPUT_WRITERxATTACHxADDxSTRING,
                  SUBSTR (getCHARACTER (mS), getFIXED (mJ),
                          xsubtract (getFIXED (mI), getFIXED (mJ))));
              OUTPUT_WRITERxATTACHxADD (0);
            }
          // IF I ~= LENGTH(S) THEN (2231)
          if (1 & (xNEQ (getFIXED (mI), LENGTH (getCHARACTER (mS)))))
            // DO; (2232)
            {
            rs3s1s2:;
              // CALL ADD(SQUOTE || SQUOTE); (2233)
              {
                putCHARACTERp (
                    mOUTPUT_WRITERxATTACHxADDxSTRING,
                    xsCAT (getCHARACTER (mSQUOTE), getCHARACTER (mSQUOTE)));
                OUTPUT_WRITERxATTACHxADD (0);
              }
              // I = I + 1; (2234)
              {
                int32_t numberRHS = (int32_t)(xadd (getFIXED (mI), 1));
                putFIXED (mI, numberRHS);
              }
              // J = I; (2235)
              {
                int32_t numberRHS = (int32_t)(getFIXED (mI));
                putFIXED (mJ, numberRHS);
              }
              // GO TO SEARCH; (2236)
              goto SEARCH;
            es3s1s2:;
            } // End of DO block
          // CALL ADD(SQUOTE); (2237)
          {
            putCHARACTERp (mOUTPUT_WRITERxATTACHxADDxSTRING,
                           getCHARACTER (mSQUOTE));
            OUTPUT_WRITERxATTACHxADD (0);
          }
          // RETURN C; (2238)
          {
            reentryGuard = 0;
            return getCHARACTER (mC);
          }
        es3s1:;
        } // End of DO block
      // J = GRAMMAR_FLAGS(PNTR); (2239)
      {
        descriptor_t *bitRHS
            = getBIT (16, mGRAMMAR_FLAGS
                              + 2 * COREHALFWORD (mOUTPUT_WRITERxATTACHxPNTR));
        int32_t numberRHS;
        numberRHS = bitToFixed (bitRHS);
        putFIXED (mJ, numberRHS);
        bitRHS->inUse = 0;
      }
      // IF (J & LEFT_BRACKET_FLAG) ~= 0 THEN (2240)
      if (1
          & (xNEQ (xAND (getFIXED (mJ), COREHALFWORD (mLEFT_BRACKET_FLAG)),
                   0)))
        // C = '[' || C; (2241)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (cToDescriptor (NULL, "["), getCHARACTER (mC));
          putCHARACTER (mC, stringRHS);
          stringRHS->inUse = 0;
        }
      // IF (J & RIGHT_BRACKET_FLAG) ~= 0 THEN (2242)
      if (1
          & (xNEQ (xAND (getFIXED (mJ), COREHALFWORD (mRIGHT_BRACKET_FLAG)),
                   0)))
        // C = C || ']'; (2243)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (getCHARACTER (mC), cToDescriptor (NULL, "]"));
          putCHARACTER (mC, stringRHS);
          stringRHS->inUse = 0;
        }
      // IF (J & LEFT_BRACE_FLAG) ~= 0 THEN (2244)
      if (1
          & (xNEQ (xAND (getFIXED (mJ), COREHALFWORD (mLEFT_BRACE_FLAG)), 0)))
        // C = '{' || C; (2245)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (cToDescriptor (NULL, "{"), getCHARACTER (mC));
          putCHARACTER (mC, stringRHS);
          stringRHS->inUse = 0;
        }
      // IF (J & RIGHT_BRACE_FLAG) ~= 0 THEN (2246)
      if (1
          & (xNEQ (xAND (getFIXED (mJ), COREHALFWORD (mRIGHT_BRACE_FLAG)), 0)))
        // C = C || '}'; (2247)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (getCHARACTER (mC), cToDescriptor (NULL, "}"));
          putCHARACTER (mC, stringRHS);
          stringRHS->inUse = 0;
        }
    es3:;
    } // End of DO block
  // RETURN C; (2248)
  {
    reentryGuard = 0;
    return getCHARACTER (mC);
  }
}
