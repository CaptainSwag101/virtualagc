/*
  File FORCE_TERMINAL.c generated by XCOM-I, 2024-08-09 12:41:08.
*/

#include "runtimeC.h"

int32_t
FORCE_TERMINAL (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "FORCE_TERMINAL");
  // IF TRACE THEN (4300)
  if (1 & (bitToFixed (getBIT (8, mTRACE))))
    // OUTPUT = 'FORCE_TERMINAL: '||ORIG||','||INVERSE; (4301)
    {
      descriptor_t *stringRHS;
      stringRHS = xsCAT (
          xsCAT (xsCAT (cToDescriptor (NULL, "FORCE_TERMINAL: "),
                        bitToCharacter (getBIT (16, mFORCE_TERMINALxORIG))),
                 cToDescriptor (NULL, ",")),
          bitToCharacter (getBIT (8, mFORCE_TERMINALxINVERSE)));
      OUTPUT (0, stringRHS);
      stringRHS->inUse = 0;
    }
  // PTR = ORIG; (4302)
  {
    descriptor_t *bitRHS = getBIT (16, mFORCE_TERMINALxORIG);
    putBIT (16, mFORCE_TERMINALxPTR, bitRHS);
    bitRHS->inUse = 0;
  }
  // DO WHILE PTR <= HALMAT_NODE_END; (4303)
  while (1
         & (xLE (COREHALFWORD (mFORCE_TERMINALxPTR),
                 COREHALFWORD (mHALMAT_NODE_END))))
    {
      // IF ~OPR(PTR) THEN (4304)
      if (1
          & (xNOT (getFIXED (mOPR + 4 * COREHALFWORD (mFORCE_TERMINALxPTR)))))
        // PTR = NEXT_FLAG(PTR) + 1; (4305)
        {
          int32_t numberRHS = (int32_t)(xadd (
              (putBITp (16, mNEXT_FLAGxPTR, getBIT (16, mFORCE_TERMINALxPTR)),
               NEXT_FLAG (0)),
              1));
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (16, mFORCE_TERMINALxPTR, bitRHS);
          bitRHS->inUse = 0;
        }
      // DO CASE INVERSE; (4306)
      {
      rs1s1:
        switch (BYTE0 (mFORCE_TERMINALxINVERSE))
          {
          case 0:
            // DO; (4308)
            {
            rs1s1s1:;
              // IF (FLAG(PTR) &  4) = 0 THEN (4308)
              if (1
                  & (xEQ (
                      xAND (BYTE0 (mFLAG
                                   + 1 * COREHALFWORD (mFORCE_TERMINALxPTR)),
                            4),
                      0)))
                // DO; (4309)
                {
                rs1s1s1s1:;
                  // IF TERMINAL(PTR,1) THEN (4310)
                  if (1
                      & (bitToFixed (
                          (putBITp (16, mTERMINALxPTR,
                                    getBIT (16, mFORCE_TERMINALxPTR)),
                           putBITp (8, mTERMINALxTAG,
                                    fixedToBit (32, (int32_t)(1))),
                           TERMINAL (0)))))
                    // DO; (4311)
                    {
                    rs1s1s1s1s1:;
                      // CALL SWITCH(ORIG,PTR); (4312)
                      {
                        putBITp (16, mSWITCHxORIG,
                                 getBIT (16, mFORCE_TERMINALxORIG));
                        putBITp (16, mSWITCHxPTR,
                                 getBIT (16, mFORCE_TERMINALxPTR));
                        SWITCH (0);
                      }
                      // RETURN; (4313)
                      {
                        reentryGuard = 0;
                        return 0;
                      }
                    es1s1s1s1s1:;
                    } // End of DO block
                es1s1s1s1:;
                } // End of DO block
              // PTR = PTR + 1; (4314)
              {
                int32_t numberRHS
                    = (int32_t)(xadd (COREHALFWORD (mFORCE_TERMINALxPTR), 1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mFORCE_TERMINALxPTR, bitRHS);
                bitRHS->inUse = 0;
              }
            es1s1s1:;
            } // End of DO block
            break;
          case 1:
            // DO ; (4316)
            {
            rs1s1s2:;
              // PTR = NEXT_FLAG(PTR,2); (4316)
              {
                int32_t numberRHS
                    = (int32_t)((putBITp (16, mNEXT_FLAGxPTR,
                                          getBIT (16, mFORCE_TERMINALxPTR)),
                                 putBITp (16, mNEXT_FLAGxBITp,
                                          fixedToBit (32, (int32_t)(2))),
                                 NEXT_FLAG (0)));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mFORCE_TERMINALxPTR, bitRHS);
                bitRHS->inUse = 0;
              }
              // IF OPR(PTR) THEN (4317)
              if (1
                  & (getFIXED (mOPR + 4 * COREHALFWORD (mFORCE_TERMINALxPTR))))
                // IF TERMINAL(PTR,1) THEN (4318)
                if (1
                    & (bitToFixed ((putBITp (16, mTERMINALxPTR,
                                             getBIT (16, mFORCE_TERMINALxPTR)),
                                    putBITp (8, mTERMINALxTAG,
                                             fixedToBit (32, (int32_t)(1))),
                                    TERMINAL (0)))))
                  // DO; (4319)
                  {
                  rs1s1s2s1:;
                    // CALL SWITCH(ORIG,PTR); (4320)
                    {
                      putBITp (16, mSWITCHxORIG,
                               getBIT (16, mFORCE_TERMINALxORIG));
                      putBITp (16, mSWITCHxPTR,
                               getBIT (16, mFORCE_TERMINALxPTR));
                      SWITCH (0);
                    }
                    // INVERSE = 0; (4321)
                    {
                      int32_t numberRHS = (int32_t)(0);
                      descriptor_t *bitRHS;
                      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                      putBIT (8, mFORCE_TERMINALxINVERSE, bitRHS);
                      bitRHS->inUse = 0;
                    }
                    // RETURN; (4322)
                    {
                      reentryGuard = 0;
                      return 0;
                    }
                  es1s1s2s1:;
                  } // End of DO block
              // PTR = PTR + 1; (4323)
              {
                int32_t numberRHS
                    = (int32_t)(xadd (COREHALFWORD (mFORCE_TERMINALxPTR), 1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mFORCE_TERMINALxPTR, bitRHS);
                bitRHS->inUse = 0;
              }
            es1s1s2:;
            } // End of DO block
            break;
          }
      } // End of DO CASE block
    }   // End of DO WHILE block
  {
    reentryGuard = 0;
    return 0;
  }
}
