/*
  File OPTIMISE.c generated by XCOM-I, 2024-08-09 12:41:08.
*/

#include "runtimeC.h"

int32_t
OPTIMISE (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "OPTIMISE");
  // DO WHILE OPTIMISING; (5553)
  while (1 & (bitToFixed (getBIT (1, mOPTIMISING))))
    {
      // DO WHILE OPR(CTR); (5554)
      while (1 & (getFIXED (mOPR + 4 * COREHALFWORD (mCTR))))
        {
          // CTR = CTR + 1; (5555)
          {
            int32_t numberRHS = (int32_t)(xadd (COREHALFWORD (mCTR), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mCTR, bitRHS);
            bitRHS->inUse = 0;
          }
        } // End of DO WHILE block
      // CALL DECODEPOP(CTR); (5556)
      {
        putBITp (16, mDECODEPOPxCTR, getBIT (16, mCTR));
        DECODEPOP (0);
      }
      // IF OPTIMIZER_OFF THEN (5557)
      if (1 & (bitToFixed (getBIT (8, mOPTIMIZER_OFF))))
        // DO; (5558)
        {
        rs1s2:;
          // IF CLASS ~= 0 THEN (5559)
          if (1 & (xNEQ (COREHALFWORD (mCLASS), 0)))
            // CTR = SMRK_CTR; (5560)
            {
              descriptor_t *bitRHS = getBIT (16, mSMRK_CTR);
              putBIT (16, mCTR, bitRHS);
              bitRHS->inUse = 0;
            }
          // ELSE (5561)
          else
            // DO; (5562)
            {
            rs1s2s1:;
              // IF OPCODE = 2 THEN (5563)
              if (1 & (xEQ (COREHALFWORD (mOPCODE), 2)))
                // DO; (5564)
                {
                rs1s2s1s1:;
                  // IF TAG THEN (5565)
                  if (1 & (bitToFixed (getBIT (16, mTAG))))
                    // OPTIMISING = FALSE; (5566)
                    {
                      int32_t numberRHS = (int32_t)(0);
                      descriptor_t *bitRHS;
                      bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                      putBIT (1, mOPTIMISING, bitRHS);
                      bitRHS->inUse = 0;
                    }
                  // RETURN; (5567)
                  {
                    reentryGuard = 0;
                    return 0;
                  }
                es1s2s1s1:;
                } // End of DO block
              // ELSE (5568)
              else
                // IF OPCODE = 4 THEN (5569)
                if (1 & (xEQ (COREHALFWORD (mOPCODE), 4)))
                  // DO; (5570)
                  {
                  rs1s2s1s2:;
                    // CALL PREPARE_HALMAT(0); (5571)
                    {
                      putBITp (1, mPREPARE_HALMATxBLOCK_FLAG,
                               fixedToBit (32, (int32_t)(0)));
                      PREPARE_HALMAT (0);
                    }
                  es1s2s1s2:;
                  } // End of DO block
              // CTR = SMRK_CTR; (5572)
              {
                descriptor_t *bitRHS = getBIT (16, mSMRK_CTR);
                putBIT (16, mCTR, bitRHS);
                bitRHS->inUse = 0;
              }
            es1s2s1:;
            } // End of DO block
        es1s2:;
        } // End of DO block
      // ELSE (5573)
      else
        // DO; (5574)
        {
        rs1s3:;
          // OP = SHR(OPR(CTR),4) &  4095; (5575)
          {
            int32_t numberRHS = (int32_t)(xAND (
                SHR (getFIXED (mOPR + 4 * COREHALFWORD (mCTR)), 4), 4095));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mOPTIMISExOP, bitRHS);
            bitRHS->inUse = 0;
          }
          // IF OP = 4 THEN (5576)
          if (1 & (xEQ (COREHALFWORD (mOPTIMISExOP), 4)))
            // DO; (5577)
            {
            rs1s3s1:;
              // CALL PREPARE_HALMAT(0); (5578)
              {
                putBITp (1, mPREPARE_HALMATxBLOCK_FLAG,
                         fixedToBit (32, (int32_t)(0)));
                PREPARE_HALMAT (0);
              }
              // CALL NEXTCODE; (5579)
              NEXTCODE (0);
            es1s3s1:;
            } // End of DO block
          // IF ~CHICKEN_OUT(CTR) | OPCODE=2 THEN (5580)
          if (1
              & (xOR (xNOT (bitToFixed (
                          (putBITp (16, mCHICKEN_OUTxFIRST, getBIT (16, mCTR)),
                           CHICKEN_OUT (0)))),
                      xEQ (COREHALFWORD (mOPCODE), 2))))
            // DO CASE OPTTYPE(CLASS); (5581)
            {
            rs1s3s2:
              switch (
                  COREHALFWORD (mOPTIMISExOPTTYPE + 2 * COREHALFWORD (mCLASS)))
                {
                case 0:
                  // DO; (5583)
                  {
                  rs1s3s2s1:;
                    // IF OPCODE = 2 THEN (5583)
                    if (1 & (xEQ (COREHALFWORD (mOPCODE), 2)))
                      // DO; (5584)
                      {
                      rs1s3s2s1s1:;
                        // IF TAG THEN (5585)
                        if (1 & (bitToFixed (getBIT (16, mTAG))))
                          // OPTIMISING = FALSE; (5586)
                          {
                            int32_t numberRHS = (int32_t)(0);
                            descriptor_t *bitRHS;
                            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                            putBIT (1, mOPTIMISING, bitRHS);
                            bitRHS->inUse = 0;
                          }
                        // RETURN; (5587)
                        {
                          reentryGuard = 0;
                          return 0;
                        }
                      es1s3s2s1s1:;
                      } // End of DO block
                    // ELSE (5588)
                    else
                      // IF OPCODE = RTRN OR OPCODE = TASN THEN (5589)
                      if (1
                          & (xOR (xEQ (COREHALFWORD (mOPCODE),
                                       COREHALFWORD (mRTRN)),
                                  xEQ (COREHALFWORD (mOPCODE),
                                       COREHALFWORD (mTASN)))))
                        // GO TO EXP; (5590)
                        goto EXP;
                  es1s3s2s1:;
                  } // End of DO block
                  break;
                case 1:
                  // DO; (5592)
                  {
                  rs1s3s2s2:;
                  // EXP: (5592)
                  EXP:
                    // CALL GROW_TREE; (5593)
                    GROW_TREE (0);
                    // DO WHILE STILL_NODES; (5594)
                    while (1 & (bitToFixed (getBIT (8, mSTILL_NODES))))
                      {
                        // CALL GET_NODE; (5595)
                        GET_NODE (0);
                        // IF SEARCHABLE THEN (5596)
                        if (1 & (bitToFixed (getBIT (8, mSEARCHABLE))))
                          // DO; (5597)
                          {
                          rs1s3s2s2s1s1:;
                            // IF CSE_MATCH_FOUND THEN (5598)
                            if (1 & (bitToFixed (CSE_MATCH_FOUND (0))))
                              // DO; (5599)
                              {
                              rs1s3s2s2s1s1s1:;
                                // IF SETUP_REARRANGE(0) THEN (5600)
                                if (1
                                    & (bitToFixed (
                                        (putBITp (
                                             8, mSETUP_REARRANGExLOOP_INVAR,
                                             fixedToBit (32, (int32_t)(0))),
                                         SETUP_REARRANGE (0)))))
                                  // DO; (5601)
                                  {
                                  rs1s3s2s2s1s1s1s1:;
                                    // CALL REARRANGE_HALMAT; (5602)
                                    REARRANGE_HALMAT (0);
                                    // CALL STRIP_NODES(0); (5603)
                                    {
                                      putBITp (8, mSTRIP_NODESxLOOP_PULL,
                                               fixedToBit (32, (int32_t)(0)));
                                      STRIP_NODES (0);
                                    }
                                    // IF STATISTICS THEN (5604)
                                    if (1
                                        & (bitToFixed (
                                            getBIT (16, mSTATISTICS))))
                                      // DO; (5605)
                                      {
                                      rs1s3s2s2s1s1s1s1s1:;
                                        // CSE# = CSE# + 1; (5606)
                                        {
                                          int32_t numberRHS = (int32_t)(xadd (
                                              COREHALFWORD (mCSEp), 1));
                                          descriptor_t *bitRHS;
                                          bitRHS = fixedToBit (
                                              32, (int32_t)(numberRHS));
                                          putBIT (16, mCSEp, bitRHS);
                                          bitRHS->inUse = 0;
                                        }
                                        // IF OPTYPE = EXTN THEN (5607)
                                        if (1
                                            & (xEQ (COREHALFWORD (mOPTYPE),
                                                    COREHALFWORD (mEXTN))))
                                          // EXTN_CSES = EXTN_CSES +1; (5608)
                                          {
                                            int32_t numberRHS
                                                = (int32_t)(xadd (
                                                    COREHALFWORD (mEXTN_CSES),
                                                    1));
                                            descriptor_t *bitRHS;
                                            bitRHS = fixedToBit (
                                                32, (int32_t)(numberRHS));
                                            putBIT (16, mEXTN_CSES, bitRHS);
                                            bitRHS->inUse = 0;
                                          }
                                        // ELSE (5609)
                                        else
                                          // IF OPTYPE = TSUB THEN (5610)
                                          if (1
                                              & (xEQ (COREHALFWORD (mOPTYPE),
                                                      COREHALFWORD (mTSUB))))
                                            // TSUB_CSES = TSUB_CSES +1; (5611)
                                            {
                                              int32_t numberRHS
                                                  = (int32_t)(xadd (
                                                      COREHALFWORD (
                                                          mTSUB_CSES),
                                                      1));
                                              descriptor_t *bitRHS;
                                              bitRHS = fixedToBit (
                                                  32, (int32_t)(numberRHS));
                                              putBIT (16, mTSUB_CSES, bitRHS);
                                              bitRHS->inUse = 0;
                                            }
                                        // IF TWIN_MATCH THEN (5612)
                                        if (1
                                            & (bitToFixed (
                                                getBIT (8, mTWIN_MATCH))))
                                          // MESSAGE = ' TWIN'; (5613)
                                          {
                                            descriptor_t *stringRHS;
                                            stringRHS = cToDescriptor (
                                                NULL, " TWIN");
                                            putCHARACTER (mMESSAGE, stringRHS);
                                            stringRHS->inUse = 0;
                                          }
                                        // ELSE (5614)
                                        else
                                          // MESSAGE = ''; (5615)
                                          {
                                            descriptor_t *stringRHS;
                                            stringRHS
                                                = cToDescriptor (NULL, "");
                                            putCHARACTER (mMESSAGE, stringRHS);
                                            stringRHS->inUse = 0;
                                          }
                                        // OUTPUT = 'CSE FOUND IN HAL/S
                                        // STATEMENT ' || STT# || '   OPTYPE =
                                        // ' || HEX(OPTYPE,4) || '  *******' ||
                                        // MESSAGE; (5616)
                                        {
                                          descriptor_t *stringRHS;
                                          stringRHS = xsCAT (
                                              xsCAT (
                                                  xsCAT (
                                                      xsCAT (
                                                          xsCAT (
                                                              cToDescriptor (
                                                                  NULL,
                                                                  "CSE FOUND "
                                                                  "IN HAL/S "
                                                                  "STATEMENT"
                                                                  " "),
                                                              bitToCharacter (
                                                                  getBIT (
                                                                      16,
                                                                      mSTTp))),
                                                          cToDescriptor (
                                                              NULL,
                                                              "   OPTYPE = ")),
                                                      (putFIXED (mHEXxHVAL,
                                                                 COREHALFWORD (
                                                                     mOPTYPE)),
                                                       putFIXED (mHEXxN, 4),
                                                       HEX (0))),
                                                  cToDescriptor (NULL,
                                                                 "  *******")),
                                              getCHARACTER (mMESSAGE));
                                          OUTPUT (0, stringRHS);
                                          stringRHS->inUse = 0;
                                        }
                                      es1s3s2s2s1s1s1s1s1:;
                                      } // End of DO block
                                  es1s3s2s2s1s1s1s1:;
                                  } // End of DO block
                                // ELSE (5617)
                                else
                                  // DO; (5618)
                                  {
                                  rs1s3s2s2s1s1s1s2:;
                                    // IF ~ARRAYED_TSUB THEN (5619)
                                    if (1 & (xNOT (BYTE0 (mARRAYED_TSUB))))
                                      // CALL EXTRACT_INVARS; (5620)
                                      EXTRACT_INVARS (0);
                                    // CALL TABLE_NODE; (5621)
                                    TABLE_NODE (0);
                                  es1s3s2s2s1s1s1s2:;
                                  } // End of DO block
                              es1s3s2s2s1s1s1:;
                              } // End of DO block
                            // ELSE (5622)
                            else
                              // DO; (5623)
                              {
                              rs1s3s2s2s1s1s2:;
                                // IF ~ARRAYED_TSUB THEN (5624)
                                if (1 & (xNOT (BYTE0 (mARRAYED_TSUB))))
                                  // CALL EXTRACT_INVARS; (5625)
                                  EXTRACT_INVARS (0);
                                // CALL TABLE_NODE; (5626)
                                TABLE_NODE (0);
                              es1s3s2s2s1s1s2:;
                              } // End of DO block
                          es1s3s2s2s1s1:;
                          } // End of DO block
                      }     // End of DO WHILE block
                    // IF POST_STATEMENT_ZAP THEN (5627)
                    if (1 & (bitToFixed (getBIT (8, mPOST_STATEMENT_ZAP))))
                      // DO; (5628)
                      {
                      rs1s3s2s2s2:;
                        // CALL ZAP_TABLES; (5629)
                        ZAP_TABLES (0);
                        // POST_STATEMENT_ZAP = FALSE; (5630)
                        {
                          int32_t numberRHS = (int32_t)(0);
                          descriptor_t *bitRHS;
                          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                          putBIT (8, mPOST_STATEMENT_ZAP, bitRHS);
                          bitRHS->inUse = 0;
                        }
                      es1s3s2s2s2:;
                      } // End of DO block
                    // ELSE (5631)
                    else
                      // IF STATEMENT_ARRAYNESS AND EXTNS_PRESENT THEN (5632)
                      if (1
                          & (xAND (BYTE0 (mSTATEMENT_ARRAYNESS),
                                   BYTE0 (mEXTNS_PRESENT))))
                        // CALL PURGE_EXTNS(N_INX); (5633)
                        {
                          putBITp (16, mPURGE_EXTNSxPTR, getBIT (16, mN_INX));
                          PURGE_EXTNS (0);
                        }
                    // IF SUBCODE2 =  1 OR OPCODE = TASN THEN (5634)
                    if (1
                        & (xOR (xEQ (COREHALFWORD (mSUBCODE2), 1),
                                xEQ (COREHALFWORD (mOPCODE),
                                     COREHALFWORD (mTASN)))))
                      // CALL ASSIGNMENT(CTR,0,0); (5635)
                      {
                        putBITp (16, mASSIGNMENTxCTR, getBIT (16, mCTR));
                        putBITp (8, mASSIGNMENTxPRESCANNING,
                                 fixedToBit (32, (int32_t)(0)));
                        putBITp (8, mASSIGNMENTxSPECIAL,
                                 fixedToBit (32, (int32_t)(0)));
                        ASSIGNMENT (0);
                      }
                    // CTR = SMRK_CTR; (5636)
                    {
                      descriptor_t *bitRHS = getBIT (16, mSMRK_CTR);
                      putBIT (16, mCTR, bitRHS);
                      bitRHS->inUse = 0;
                    }
                  es1s3s2s2:;
                  } // End of DO block
                  break;
                case 2:
                  // CTR = SMRK_CTR; (5638)
                  {
                    descriptor_t *bitRHS = getBIT (16, mSMRK_CTR);
                    putBIT (16, mCTR, bitRHS);
                    bitRHS->inUse = 0;
                  }
                  break;
                }
            } // End of DO CASE block
          // IF POST_STATEMENT_PUSH THEN (5638)
          if (1 & (bitToFixed (getBIT (8, mPOST_STATEMENT_PUSH))))
            // DO; (5639)
            {
            rs1s3s3:;
              // CALL PUSH_STACK(INL#); (5640)
              {
                putBITp (16, mPUSH_STACKxINLp, getBIT (16, mINLp));
                PUSH_STACK (0);
              }
              // CALL PUSH_ZAP_STACK; (5641)
              PUSH_ZAP_STACK (0);
              // INL#,POST_STATEMENT_PUSH = 0; (5642)
              {
                int32_t numberRHS = (int32_t)(0);
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mINLp, bitRHS);
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (8, mPOST_STATEMENT_PUSH, bitRHS);
                bitRHS->inUse = 0;
              }
              // IF STACK_TRACE THEN (5643)
              if (1 & (bitToFixed (getBIT (8, mSTACK_TRACE))))
                // CALL STACK_DUMP; (5644)
                STACK_DUMP (0);
            es1s3s3:;
            } // End of DO block
          // CTR = SMRK_CTR; (5645)
          {
            descriptor_t *bitRHS = getBIT (16, mSMRK_CTR);
            putBIT (16, mCTR, bitRHS);
            bitRHS->inUse = 0;
          }
        es1s3:;
        } // End of DO block
    }     // End of DO WHILE block
  {
    reentryGuard = 0;
    return 0;
  }
}
