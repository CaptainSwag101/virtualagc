/*
  File STREAMxSCAN_CARD.c generated by XCOM-I, 2024-08-09 12:40:41.
*/

#include "runtimeC.h"

int32_t
STREAMxSCAN_CARD (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "STREAMxSCAN_CARD");
  // POINT = SHL(TYPE, IND_SHIFT); (4501)
  {
    int32_t numberRHS = (int32_t)(SHL (getFIXED (mSTREAMxSCAN_CARDxTYPE), 7));
    putFIXED (mSTREAMxSCAN_CARDxPOINT, numberRHS);
  }
  // DO CP = 1 TO TEXT_LIMIT; (4502)
  {
    int32_t from78, to78, by78;
    from78 = 1;
    to78 = bitToFixed (getBIT (16, mTEXT_LIMIT));
    by78 = 1;
    for (putBIT (16, mSTREAMxCP, fixedToBit (16, from78));
         bitToFixed (getBIT (16, mSTREAMxCP)) <= to78;
         putBIT (16, mSTREAMxCP,
                 fixedToBit (16, bitToFixed (getBIT (16, mSTREAMxCP)) + by78)))
      {
        // IF BYTE(CURRENT_CARD, CP) ~= BYTE(X1) THEN (4503)
        if (1
            & (xNEQ (
                BYTE (getCHARACTER (mCURRENT_CARD), COREHALFWORD (mSTREAMxCP)),
                BYTE1 (getCHARACTER (mX1)))))
          // DO; (4504)
          {
          rs1s1:;
            // IF BYTE(E_LINE(TYPE), CP) ~= BYTE(X1) THEN (4505)
            if (1
                & (xNEQ (BYTE (getCHARACTER (
                                   mSTREAMxE_LINE
                                   + 4 * getFIXED (mSTREAMxSCAN_CARDxTYPE)),
                               COREHALFWORD (mSTREAMxCP)),
                         BYTE1 (getCHARACTER (mX1)))))
              // DO CASE TYPE; (4506)
              {
              rs1s1s1:
                switch (getFIXED (mSTREAMxSCAN_CARDxTYPE))
                  {
                  case 0:
                    // CALL ERROR(CLASS_ME,4); (4508)
                    {
                      putBITp (16, mERRORxCLASS, getBIT (16, mCLASS_ME));
                      putBITp (8, mERRORxNUM, fixedToBit (32, (int32_t)(4)));
                      ERROR (0);
                    }
                    break;
                  case 1:
                    // DO; (4509)
                    {
                    rs1s1s1s1:;
                      // CALL ERROR(CLASS_MS,4); (4509)
                      {
                        putBITp (16, mERRORxCLASS, getBIT (16, mCLASS_MS));
                        putBITp (8, mERRORxNUM, fixedToBit (32, (int32_t)(4)));
                        ERROR (0);
                      }
                      // GO TO CONTINUE; (4510)
                      goto CONTINUE;
                    es1s1s1s1:;
                    } // End of DO block
                    break;
                  }
              } // End of DO CASE block
            // E_INDICATOR(CP + POINT) = E_COUNT(TYPE); (4511)
            {
              descriptor_t *bitRHS = getBIT (
                  16, mSTREAMxE_COUNT + 2 * getFIXED (mSTREAMxSCAN_CARDxTYPE));
              putBIT (16,
                      mSTREAMxE_INDICATOR
                          + 2
                                * (xadd (COREHALFWORD (mSTREAMxCP),
                                         getFIXED (mSTREAMxSCAN_CARDxPOINT))),
                      bitRHS);
              bitRHS->inUse = 0;
            }
            // FILL = BYTE(CURRENT_CARD, CP); (4512)
            {
              int32_t numberRHS = (int32_t)(BYTE (getCHARACTER (mCURRENT_CARD),
                                                  COREHALFWORD (mSTREAMxCP)));
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (16, mSTREAMxFILL, bitRHS);
              bitRHS->inUse = 0;
            }
            // BYTE(E_LINE(TYPE), CP) = FILL; (4513)
            {
              descriptor_t *bitRHS = getBIT (16, mSTREAMxFILL);
              lBYTEb (ADDR (NULL, 0, "STREAMxE_LINE",
                            getFIXED (mSTREAMxSCAN_CARDxTYPE)),
                      COREHALFWORD (mSTREAMxCP), COREHALFWORD (mSTREAMxFILL));
              bitRHS->inUse = 0;
            }
          es1s1:;
          } // End of DO block
      // CONTINUE: (4514)
      CONTINUE:;
      }
  } // End of DO for-loop block
  {
    reentryGuard = 0;
    return 0;
  }
}
