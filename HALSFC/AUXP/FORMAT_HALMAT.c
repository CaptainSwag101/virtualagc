/*
  File FORMAT_HALMAT.c generated by XCOM-I, 2024-08-09 12:39:13.
*/

#include "runtimeC.h"

descriptor_t *
FORMAT_HALMAT (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (descriptor_t *)0;
    }
  reentryGuard = guardReentry (reentryGuard, "FORMAT_HALMAT");
  // IF HALMAT# >= HALMAT_SIZE THEN (650)
  if (1 & (xGE (COREHALFWORD (mFORMAT_HALMATxHALMATp), 1800)))
    // DO; (651)
    {
    rs1:;
      // HALMAT_PRINT# = HALMAT# - 1800; (652)
      {
        int32_t numberRHS = (int32_t)(xsubtract (
            COREHALFWORD (mFORMAT_HALMATxHALMATp), 1800));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mFORMAT_HALMATxHALMAT_PRINTp, bitRHS);
        bitRHS->inUse = 0;
      }
      // BLOCK# = CURR_HALMAT_BLOCK - 1; (653)
      {
        int32_t numberRHS
            = (int32_t)(xsubtract (COREHALFWORD (mCURR_HALMAT_BLOCK), 1));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mFORMAT_HALMATxBLOCKp, bitRHS);
        bitRHS->inUse = 0;
      }
    es1:;
    } // End of DO block
  // ELSE (654)
  else
    // DO; (655)
    {
    rs2:;
      // HALMAT_PRINT# = HALMAT#; (656)
      {
        descriptor_t *bitRHS = getBIT (16, mFORMAT_HALMATxHALMATp);
        putBIT (16, mFORMAT_HALMATxHALMAT_PRINTp, bitRHS);
        bitRHS->inUse = 0;
      }
      // IF BLOCK_PRIME THEN (657)
      if (1 & (bitToFixed (getBIT (1, mBLOCK_PRIME))))
        // BLOCK# = CURR_HALMAT_BLOCK - 2; (658)
        {
          int32_t numberRHS
              = (int32_t)(xsubtract (COREHALFWORD (mCURR_HALMAT_BLOCK), 2));
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (16, mFORMAT_HALMATxBLOCKp, bitRHS);
          bitRHS->inUse = 0;
        }
      // ELSE (659)
      else
        // BLOCK# = CURR_HALMAT_BLOCK - 1; (660)
        {
          int32_t numberRHS
              = (int32_t)(xsubtract (COREHALFWORD (mCURR_HALMAT_BLOCK), 1));
          descriptor_t *bitRHS;
          bitRHS = fixedToBit (32, (int32_t)(numberRHS));
          putBIT (16, mFORMAT_HALMATxBLOCKp, bitRHS);
          bitRHS->inUse = 0;
        }
    es2:;
    } // End of DO block
  // TEMP_MAT = HALMAT(HALMAT#); (661)
  {
    int32_t numberRHS = (int32_t)(getFIXED (
        mHALMAT + 4 * COREHALFWORD (mFORMAT_HALMATxHALMATp)));
    putFIXED (mTEMP_MAT, numberRHS);
  }
  // IF (TEMP_MAT & 1) = 0 THEN (662)
  if (1 & (xEQ (xAND (getFIXED (mTEMP_MAT), 1), 0)))
    // MESSAGE = '           HALMAT:   ' || HEX(SHR(TEMP_MAT, 4) &  4095, 3) ||
    // LEFT_PAREN || #RJUST(SHR(TEMP_MAT, 16) &  255, 3) ||  RIGHT_PAREN ||
    // COMMA || #RJUST(SHR(TEMP_MAT, 24) &  255, 3) ||  COMMA ||
    // #RJUST(SHR(TEMP_MAT, 1) &  7, 1) ||  COLON || #RJUST(BLOCK#, 3) ||
    // PERIOD || #RJUST(HALMAT_PRINT#, 4) || BLANK; (663)
    {
      descriptor_t *stringRHS;
      stringRHS = xsCAT (
          xsCAT (
              xsCAT (
                  xsCAT (
                      xsCAT (
                          xsCAT (
                              xsCAT (
                                  xsCAT (
                                      xsCAT (
                                          xsCAT (
                                              xsCAT (
                                                  xsCAT (
                                                      xsCAT (
                                                          cToDescriptor (
                                                              NULL,
                                                              "           "
                                                              "HALMAT:   "),
                                                          (putBITp (
                                                               16, mHEXxNUMBER,
                                                               fixedToBit (
                                                                   32,
                                                                   (int32_t)(xAND (
                                                                       SHR (
                                                                           getFIXED (
                                                                               mTEMP_MAT),
                                                                           4),
                                                                       4095)))),
                                                           putBITp (
                                                               16,
                                                               mHEXxTOTAL_LENGTH,
                                                               fixedToBit (
                                                                   32,
                                                                   (int32_t)(3))),
                                                           HEX (0))),
                                                      getCHARACTER (
                                                          mLEFT_PAREN)),
                                                  (putBITp (
                                                       16, mpRJUSTxNUMBER,
                                                       fixedToBit (
                                                           32,
                                                           (int32_t)(xAND (
                                                               SHR (
                                                                   getFIXED (
                                                                       mTEMP_MAT),
                                                                   16),
                                                               255)))),
                                                   putBITp (
                                                       16,
                                                       mpRJUSTxTOTAL_LENGTH,
                                                       fixedToBit (
                                                           32, (int32_t)(3))),
                                                   pRJUST (0))),
                                              getCHARACTER (mRIGHT_PAREN)),
                                          getCHARACTER (mCOMMA)),
                                      (putBITp (
                                           16, mpRJUSTxNUMBER,
                                           fixedToBit (
                                               32,
                                               (int32_t)(xAND (
                                                   SHR (getFIXED (mTEMP_MAT),
                                                        24),
                                                   255)))),
                                       putBITp (16, mpRJUSTxTOTAL_LENGTH,
                                                fixedToBit (32, (int32_t)(3))),
                                       pRJUST (0))),
                                  getCHARACTER (mCOMMA)),
                              (putBITp (
                                   16, mpRJUSTxNUMBER,
                                   fixedToBit (
                                       32, (int32_t)(xAND (
                                               SHR (getFIXED (mTEMP_MAT), 1),
                                               7)))),
                               putBITp (16, mpRJUSTxTOTAL_LENGTH,
                                        fixedToBit (32, (int32_t)(1))),
                               pRJUST (0))),
                          getCHARACTER (mCOLON)),
                      (putBITp (16, mpRJUSTxNUMBER,
                                getBIT (16, mFORMAT_HALMATxBLOCKp)),
                       putBITp (16, mpRJUSTxTOTAL_LENGTH,
                                fixedToBit (32, (int32_t)(3))),
                       pRJUST (0))),
                  getCHARACTER (mPERIOD)),
              (putBITp (16, mpRJUSTxNUMBER,
                        getBIT (16, mFORMAT_HALMATxHALMAT_PRINTp)),
               putBITp (16, mpRJUSTxTOTAL_LENGTH,
                        fixedToBit (32, (int32_t)(4))),
               pRJUST (0))),
          getCHARACTER (mBLANK));
      putCHARACTER (mFORMAT_HALMATxMESSAGE, stringRHS);
      stringRHS->inUse = 0;
    }
  // ELSE (664)
  else
    // DO; (665)
    {
    rs3:;
      // MESSAGE = '                   ' || #RJUST(SHR(TEMP_MAT, 16) &  32767,
      // 5) ||  LEFT_PAREN || #RJUST(SHR(TEMP_MAT, 4) &  15, 3) ||  RIGHT_PAREN
      // || COMMA || #RJUST(SHR(TEMP_MAT, 8) &  255, 3) ||  COMMA ||
      // #RJUST(SHR(TEMP_MAT, 1) &  7, 1) ||  COLON || #RJUST(BLOCK#, 3) ||
      // PERIOD || #RJUST(HALMAT_PRINT#, 4); (666)
      {
        descriptor_t *stringRHS;
        stringRHS = xsCAT (
            xsCAT (
                xsCAT (
                    xsCAT (
                        xsCAT (
                            xsCAT (
                                xsCAT (
                                    xsCAT (
                                        xsCAT (
                                            xsCAT (
                                                xsCAT (
                                                    xsCAT (
                                                        cToDescriptor (
                                                            NULL, "           "
                                                                  "        "),
                                                        (putBITp (
                                                             16,
                                                             mpRJUSTxNUMBER,
                                                             fixedToBit (
                                                                 32,
                                                                 (int32_t)(xAND (
                                                                     SHR (
                                                                         getFIXED (
                                                                             mTEMP_MAT),
                                                                         16),
                                                                     32767)))),
                                                         putBITp (
                                                             16,
                                                             mpRJUSTxTOTAL_LENGTH,
                                                             fixedToBit (
                                                                 32,
                                                                 (int32_t)(5))),
                                                         pRJUST (0))),
                                                    getCHARACTER (
                                                        mLEFT_PAREN)),
                                                (putBITp (
                                                     16, mpRJUSTxNUMBER,
                                                     fixedToBit (
                                                         32,
                                                         (int32_t)(xAND (
                                                             SHR (
                                                                 getFIXED (
                                                                     mTEMP_MAT),
                                                                 4),
                                                             15)))),
                                                 putBITp (
                                                     16, mpRJUSTxTOTAL_LENGTH,
                                                     fixedToBit (
                                                         32, (int32_t)(3))),
                                                 pRJUST (0))),
                                            getCHARACTER (mRIGHT_PAREN)),
                                        getCHARACTER (mCOMMA)),
                                    (putBITp (
                                         16, mpRJUSTxNUMBER,
                                         fixedToBit (
                                             32,
                                             (int32_t)(xAND (
                                                 SHR (getFIXED (mTEMP_MAT), 8),
                                                 255)))),
                                     putBITp (16, mpRJUSTxTOTAL_LENGTH,
                                              fixedToBit (32, (int32_t)(3))),
                                     pRJUST (0))),
                                getCHARACTER (mCOMMA)),
                            (putBITp (
                                 16, mpRJUSTxNUMBER,
                                 fixedToBit (
                                     32,
                                     (int32_t)(xAND (
                                         SHR (getFIXED (mTEMP_MAT), 1), 7)))),
                             putBITp (16, mpRJUSTxTOTAL_LENGTH,
                                      fixedToBit (32, (int32_t)(1))),
                             pRJUST (0))),
                        getCHARACTER (mCOLON)),
                    (putBITp (16, mpRJUSTxNUMBER,
                              getBIT (16, mFORMAT_HALMATxBLOCKp)),
                     putBITp (16, mpRJUSTxTOTAL_LENGTH,
                              fixedToBit (32, (int32_t)(3))),
                     pRJUST (0))),
                getCHARACTER (mPERIOD)),
            (putBITp (16, mpRJUSTxNUMBER,
                      getBIT (16, mFORMAT_HALMATxHALMAT_PRINTp)),
             putBITp (16, mpRJUSTxTOTAL_LENGTH, fixedToBit (32, (int32_t)(4))),
             pRJUST (0)));
        putCHARACTER (mFORMAT_HALMATxMESSAGE, stringRHS);
        stringRHS->inUse = 0;
      }
      // IF (TEMP_MAT &  2147483648) ~= 0 THEN (667)
      if (1 & (xNEQ (xAND (getFIXED (mTEMP_MAT), 2147483648), 0)))
        // MESSAGE = MESSAGE || ASTERISK; (668)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (getCHARACTER (mFORMAT_HALMATxMESSAGE),
                             getCHARACTER (mASTERISK));
          putCHARACTER (mFORMAT_HALMATxMESSAGE, stringRHS);
          stringRHS->inUse = 0;
        }
      // ELSE (669)
      else
        // MESSAGE = MESSAGE || BLANK; (670)
        {
          descriptor_t *stringRHS;
          stringRHS = xsCAT (getCHARACTER (mFORMAT_HALMATxMESSAGE),
                             getCHARACTER (mBLANK));
          putCHARACTER (mFORMAT_HALMATxMESSAGE, stringRHS);
          stringRHS->inUse = 0;
        }
    es3:;
    } // End of DO block
  // RETURN MESSAGE; (671)
  {
    reentryGuard = 0;
    return getCHARACTER (mFORMAT_HALMATxMESSAGE);
  }
}
