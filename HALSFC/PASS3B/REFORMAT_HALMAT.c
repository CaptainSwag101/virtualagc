/*
  File REFORMAT_HALMAT.c generated by XCOM-I, 2024-08-09 12:42:16.
*/

#include "runtimeC.h"

int32_t
REFORMAT_HALMAT (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "REFORMAT_HALMAT");
  // IF LOC = NILL THEN (1385)
  if (1 & (xEQ (getFIXED (mREFORMAT_HALMATxLOC), -1)))
    // RETURN NILL; (1386)
    {
      reentryGuard = 0;
      return -1;
    }
  // HLOC = LOC; (1387)
  {
    int32_t numberRHS = (int32_t)(getFIXED (mREFORMAT_HALMATxLOC));
    putFIXED (mREFORMAT_HALMATxHLOC, numberRHS);
  }
  // CALL LOCATE(HLOC,ADDR(HMAT_PTR),RESV); (1388)
  {
    putFIXED (mLOCATExPTR, getFIXED (mREFORMAT_HALMATxHLOC));
    putFIXED (mLOCATExBVAR,
              ADDR ("REFORMAT_HALMATxHMAT_PTR", 0x80000000, NULL, 0));
    putBITp (8, mLOCATExFLAGS, getBIT (8, mRESV));
    LOCATE (0);
  }
  // SIZE = #HMAT_WORDS+1; (1389)
  {
    int32_t numberRHS = (int32_t)(xadd (
        SHR (getFIXED (getFIXED (mREFORMAT_HALMATxHMAT_PTR)), 16), 1));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mREFORMAT_HALMATxSIZE, bitRHS);
    bitRHS->inUse = 0;
  }
  // INITIAL_CASE = TRUE; (1390)
  {
    int32_t numberRHS = (int32_t)(1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (1, mREFORMAT_HALMATxINITIAL_CASE, bitRHS);
    bitRHS->inUse = 0;
  }
  // HCELL = 1; (1391)
  {
    int32_t numberRHS = (int32_t)(1);
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mREFORMAT_HALMATxHCELL, bitRHS);
    bitRHS->inUse = 0;
  }
  // DO WHILE SIZE > 0; (1392)
  while (1 & (xGT (COREHALFWORD (mREFORMAT_HALMATxSIZE), 0)))
    {
      // TMP_LOC = SLOC; (1393)
      {
        int32_t numberRHS = (int32_t)(getFIXED (mREFORMAT_HALMATxSLOC));
        putFIXED (mREFORMAT_HALMATxTMP_LOC, numberRHS);
      }
      // SLOC = GET_DATA_CELL(HMAT_BLK_SZ,ADDR(SDF_PTR),RESV|MODF); (1394)
      {
        int32_t numberRHS = (int32_t)((
            putFIXED (mGET_DATA_CELLxLENGTH,
                      (putFIXED (mMINxA,
                                 xmultiply (
                                     COREHALFWORD (mREFORMAT_HALMATxSIZE), 4)),
                       putFIXED (mMINxB, 1680), MIN (0))),
            putFIXED (mGET_DATA_CELLxBVAR,
                      ADDR ("REFORMAT_HALMATxSDF_PTR", 0x80000000, NULL, 0)),
            putBITp (8, mGET_DATA_CELLxFLAGS,
                     fixedToBit (
                         32, (int32_t)(xOR (BYTE0 (mRESV), BYTE0 (mMODF))))),
            GET_DATA_CELL (0)));
        putFIXED (mREFORMAT_HALMATxSLOC, numberRHS);
      }
      // IF INITIAL_CASE THEN (1395)
      if (1 & (bitToFixed (getBIT (1, mREFORMAT_HALMATxINITIAL_CASE))))
        // DO; (1396)
        {
        rs1s1:;
          // RET_LOC = SLOC; (1397)
          {
            int32_t numberRHS = (int32_t)(getFIXED (mREFORMAT_HALMATxSLOC));
            putFIXED (mREFORMAT_HALMATxRET_LOC, numberRHS);
          }
          // SDF_PTR(0) = HMAT_PTR(0); (1398)
          {
            int32_t numberRHS = (int32_t)(getFIXED (
                getFIXED (mREFORMAT_HALMATxHMAT_PTR) + 4 * 0));
            putFIXED (getFIXED (mREFORMAT_HALMATxSDF_PTR) + 4 * (0),
                      numberRHS);
          }
        es1s1:;
        } // End of DO block
      // ELSE (1399)
      else
        // DO; (1400)
        {
        rs1s2:;
          // COREWORD(LINKCELL) = SLOC; (1401)
          {
            int32_t numberRHS = (int32_t)(getFIXED (mREFORMAT_HALMATxSLOC));
            COREWORD2 (getFIXED (mREFORMAT_HALMATxLINKCELL), numberRHS);
          }
          // CALL P3_PTR_LOCATE(TMP_LOC,RELS); (1402)
          {
            putFIXED (mP3_PTR_LOCATExPTR, getFIXED (mREFORMAT_HALMATxTMP_LOC));
            putBITp (8, mP3_PTR_LOCATExFLAGS, getBIT (8, mRELS));
            P3_PTR_LOCATE (0);
          }
        es1s2:;
        } // End of DO block
      // LIMIT = WORDS_IN_BLK-LINK_SPACE; (1403)
      {
        int32_t numberRHS = (int32_t)(xsubtract (
            (putFIXED (mMINxA, COREHALFWORD (mREFORMAT_HALMATxSIZE)),
             putFIXED (mMINxB, 420), MIN (0)),
            xmultiply (xGT (COREHALFWORD (mREFORMAT_HALMATxSIZE), 420), 2)));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mREFORMAT_HALMATxLIMIT, bitRHS);
        bitRHS->inUse = 0;
      }
      // SIZE = SIZE-LIMIT; (1404)
      {
        int32_t numberRHS
            = (int32_t)(xsubtract (COREHALFWORD (mREFORMAT_HALMATxSIZE),
                                   COREHALFWORD (mREFORMAT_HALMATxLIMIT)));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16, mREFORMAT_HALMATxSIZE, bitRHS);
        bitRHS->inUse = 0;
      }
      // DO I = START TO LIMIT-1; (1405)
      {
        int32_t from34, to34, by34;
        from34 = bitToFixed (getBIT (1, mREFORMAT_HALMATxINITIAL_CASE));
        to34 = xsubtract (COREHALFWORD (mREFORMAT_HALMATxLIMIT), 1);
        by34 = 1;
        for (putBIT (16, mREFORMAT_HALMATxI, fixedToBit (16, from34));
             bitToFixed (getBIT (16, mREFORMAT_HALMATxI)) <= to34; putBIT (
                 16, mREFORMAT_HALMATxI,
                 fixedToBit (16, bitToFixed (getBIT (16, mREFORMAT_HALMATxI))
                                     + by34)))
          {
            // INITIAL_CASE = FALSE; (1406)
            {
              int32_t numberRHS = (int32_t)(0);
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (1, mREFORMAT_HALMATxINITIAL_CASE, bitRHS);
              bitRHS->inUse = 0;
            }
            // IF HMAT_PTR(HCELL) = XREC_WORD THEN (1407)
            if (1
                & (xEQ (getFIXED (getFIXED (mREFORMAT_HALMATxHMAT_PTR)
                                  + 4 * COREHALFWORD (mREFORMAT_HALMATxHCELL)),
                        32)))
              // DO; (1408)
              {
              rs1s3s1:;
                // TMP_LOC = HLOC; (1409)
                {
                  int32_t numberRHS
                      = (int32_t)(getFIXED (mREFORMAT_HALMATxHLOC));
                  putFIXED (mREFORMAT_HALMATxTMP_LOC, numberRHS);
                }
                // HLOC = HMAT_PTR(HCELL+1); (1410)
                {
                  int32_t numberRHS = (int32_t)(getFIXED (
                      getFIXED (mREFORMAT_HALMATxHMAT_PTR)
                      + 4 * xadd (COREHALFWORD (mREFORMAT_HALMATxHCELL), 1)));
                  putFIXED (mREFORMAT_HALMATxHLOC, numberRHS);
                }
                // CALL PTR_LOCATE(TMP_LOC,RELS); (1411)
                {
                  putFIXED (mPTR_LOCATExPTR,
                            getFIXED (mREFORMAT_HALMATxTMP_LOC));
                  putBITp (8, mPTR_LOCATExFLAGS, getBIT (8, mRELS));
                  PTR_LOCATE (0);
                }
                // CALL LOCATE(HLOC,ADDR(HMAT_PTR),RESV); (1412)
                {
                  putFIXED (mLOCATExPTR, getFIXED (mREFORMAT_HALMATxHLOC));
                  putFIXED (mLOCATExBVAR, ADDR ("REFORMAT_HALMATxHMAT_PTR",
                                                0x80000000, NULL, 0));
                  putBITp (8, mLOCATExFLAGS, getBIT (8, mRESV));
                  LOCATE (0);
                }
                // HCELL = 0; (1413)
                {
                  int32_t numberRHS = (int32_t)(0);
                  descriptor_t *bitRHS;
                  bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                  putBIT (16, mREFORMAT_HALMATxHCELL, bitRHS);
                  bitRHS->inUse = 0;
                }
              es1s3s1:;
              } // End of DO block
            // SDF_PTR(I) = MOD_HMAT(HCELL); (1414)
            {
              int32_t numberRHS = (int32_t)((
                  putFIXED (mREFORMAT_HALMATxMOD_HMATxCELL,
                            COREHALFWORD (mREFORMAT_HALMATxHCELL)),
                  REFORMAT_HALMATxMOD_HMAT (0)));
              putFIXED (getFIXED (mREFORMAT_HALMATxSDF_PTR)
                            + 4 * (COREHALFWORD (mREFORMAT_HALMATxI)),
                        numberRHS);
            }
            // HCELL = HCELL+1; (1415)
            {
              int32_t numberRHS
                  = (int32_t)(xadd (COREHALFWORD (mREFORMAT_HALMATxHCELL), 1));
              descriptor_t *bitRHS;
              bitRHS = fixedToBit (32, (int32_t)(numberRHS));
              putBIT (16, mREFORMAT_HALMATxHCELL, bitRHS);
              bitRHS->inUse = 0;
            }
          }
      } // End of DO for-loop block
      // IF SIZE > 0 THEN (1416)
      if (1 & (xGT (COREHALFWORD (mREFORMAT_HALMATxSIZE), 0)))
        // DO; (1417)
        {
        rs1s4:;
          // SDF_PTR(I) = POINTER_PREFIX; (1418)
          {
            int32_t numberRHS = (int32_t)(-1);
            putFIXED (getFIXED (mREFORMAT_HALMATxSDF_PTR)
                          + 4 * (COREHALFWORD (mREFORMAT_HALMATxI)),
                      numberRHS);
          }
          // LINKCELL = ADDR(SDF_PTR(I+1)); (1419)
          {
            int32_t numberRHS = (int32_t)(ADDR (
                "REFORMAT_HALMATxSDF_PTR",
                xadd (COREHALFWORD (mREFORMAT_HALMATxI), 1), NULL, 0));
            putFIXED (mREFORMAT_HALMATxLINKCELL, numberRHS);
          }
        es1s4:;
        } // End of DO block
    }     // End of DO WHILE block
  // CALL P3_PTR_LOCATE(SLOC,RELS); (1420)
  {
    putFIXED (mP3_PTR_LOCATExPTR, getFIXED (mREFORMAT_HALMATxSLOC));
    putBITp (8, mP3_PTR_LOCATExFLAGS, getBIT (8, mRELS));
    P3_PTR_LOCATE (0);
  }
  // CALL PTR_LOCATE(HLOC,RELS); (1421)
  {
    putFIXED (mPTR_LOCATExPTR, getFIXED (mREFORMAT_HALMATxHLOC));
    putBITp (8, mPTR_LOCATExFLAGS, getBIT (8, mRELS));
    PTR_LOCATE (0);
  }
  // RETURN RET_LOC; (1422)
  {
    reentryGuard = 0;
    return getFIXED (mREFORMAT_HALMATxRET_LOC);
  }
}
