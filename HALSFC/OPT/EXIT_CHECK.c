/*
  File EXIT_CHECK.c generated by XCOM-I, 2024-08-08 04:31:49.
*/

#include "runtimeC.h"

int32_t
EXIT_CHECK (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "EXIT_CHECK");
  // IF XHALMAT_QUAL(PTR + 1) = XINL THEN (3378)
  if (1
      & (xEQ (bitToFixed (
                  (putBITp (16, mXHALMAT_QUALxPTR,
                            fixedToBit (
                                32, (int32_t)(xadd (
                                        COREHALFWORD (mEXIT_CHECKxPTR), 1)))),
                   XHALMAT_QUAL (0))),
              COREHALFWORD (mXINL))))
    // DO; (3379)
    {
    rs1:;
      // IF SHR(OPR(PTR),24) THEN (3380)
      if (1 & (SHR (getFIXED (mOPR + 4 * COREHALFWORD (mEXIT_CHECKxPTR)), 24)))
        // DO; (3381)
        {
        rs1s1:;
          // CALL POP_STACK; (3382)
          POP_STACK (0);
          // CALL PUSH_STACK; (3383)
          PUSH_STACK (0);
          // STACK_TAGS(LEVEL) = 1; (3384)
          {
            int32_t numberRHS = (int32_t)(1);
            putBIT (8,
                    getFIXED (mLEVEL_STACK_VARS) + 11 * (COREHALFWORD (mLEVEL))
                        + 10 + 1 * (0),
                    fixedToBit (8, numberRHS));
          }
          // CALL PUSH_ZAP_STACK; (3385)
          PUSH_ZAP_STACK (0);
          // IF STACK_TRACE THEN (3386)
          if (1 & (bitToFixed (getBIT (8, mSTACK_TRACE))))
            // CALL STACK_DUMP; (3387)
            STACK_DUMP (0);
        es1s1:;
        } // End of DO block
      // ELSE (3388)
      else
        // DO; (3389)
        {
        rs1s2:;
          // PTR = SHR(OPR(PTR + 1),16); (3390)
          {
            int32_t numberRHS = (int32_t)(SHR (
                getFIXED (mOPR + 4 * xadd (COREHALFWORD (mEXIT_CHECKxPTR), 1)),
                16));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mEXIT_CHECKxPTR, bitRHS);
            bitRHS->inUse = 0;
          }
          // I = DO_INX; (3391)
          {
            descriptor_t *bitRHS = getBIT (16, mDO_INX);
            putBIT (16, mEXIT_CHECKxI, bitRHS);
            bitRHS->inUse = 0;
          }
          // DO WHILE I > 0; (3392)
          while (1 & (xGT (COREHALFWORD (mEXIT_CHECKxI), 0)))
            {
              // IF DO_LIST(I) = PTR THEN (3393)
              if (1
                  & (xEQ (COREHALFWORD (mDO_LIST
                                        + 2 * COREHALFWORD (mEXIT_CHECKxI)),
                          COREHALFWORD (mEXIT_CHECKxPTR))))
                // DO_LIST(I) = -DO_LIST(I); (3394)
                {
                  int32_t numberRHS = (int32_t)(xminus (COREHALFWORD (
                      mDO_LIST + 2 * COREHALFWORD (mEXIT_CHECKxI))));
                  descriptor_t *bitRHS;
                  bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                  putBIT (16, mDO_LIST + 2 * (COREHALFWORD (mEXIT_CHECKxI)),
                          bitRHS);
                  bitRHS->inUse = 0;
                }
              // I = I - 1; (3395)
              {
                int32_t numberRHS
                    = (int32_t)(xsubtract (COREHALFWORD (mEXIT_CHECKxI), 1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mEXIT_CHECKxI, bitRHS);
                bitRHS->inUse = 0;
              }
            } // End of DO WHILE block
          // DO FOR I = 0 TO LEVEL; (3396)
          {
            int32_t from85, to85, by85;
            from85 = 0;
            to85 = bitToFixed (getBIT (16, mLEVEL));
            by85 = 1;
            for (putBIT (16, mEXIT_CHECKxI, fixedToBit (16, from85));
                 bitToFixed (getBIT (16, mEXIT_CHECKxI)) <= to85; putBIT (
                     16, mEXIT_CHECKxI,
                     fixedToBit (16, bitToFixed (getBIT (16, mEXIT_CHECKxI))
                                         + by85)))
              {
                // IF STACK_INL#(I) = PTR | STACK_INL#(I) = PTR - 1 THEN (3397)
                if (1
                    & (xOR (
                        xEQ (
                            COREHALFWORD (getFIXED (mLEVEL_STACK_VARS)
                                          + 11 * (COREHALFWORD (mEXIT_CHECKxI))
                                          + 6 + 2 * (0)),
                            COREHALFWORD (mEXIT_CHECKxPTR)),
                        xEQ (
                            COREHALFWORD (getFIXED (mLEVEL_STACK_VARS)
                                          + 11 * (COREHALFWORD (mEXIT_CHECKxI))
                                          + 6 + 2 * (0)),
                            xsubtract (COREHALFWORD (mEXIT_CHECKxPTR), 1)))))
                  // DO; (3398)
                  {
                  rs1s2s2s1:;
                    // CALL ERASE_ZAPS; (3399)
                    ERASE_ZAPS (0);
                    // IF STACK_INL#(I) = PTR THEN (3400)
                    if (1
                        & (xEQ (
                            COREHALFWORD (getFIXED (mLEVEL_STACK_VARS)
                                          + 11 * (COREHALFWORD (mEXIT_CHECKxI))
                                          + 6 + 2 * (0)),
                            COREHALFWORD (mEXIT_CHECKxPTR))))
                      // STACK_TAGS(I) = STACK_TAGS(I) |  2; (3401)
                      {
                        int32_t numberRHS = (int32_t)(xOR (
                            BYTE0 (getFIXED (mLEVEL_STACK_VARS)
                                   + 11 * (COREHALFWORD (mEXIT_CHECKxI)) + 10
                                   + 1 * (0)),
                            2));
                        putBIT (8,
                                getFIXED (mLEVEL_STACK_VARS)
                                    + 11 * (COREHALFWORD (mEXIT_CHECKxI)) + 10
                                    + 1 * (0),
                                fixedToBit (8, numberRHS));
                      }
                    // RETURN; (3402)
                    {
                      reentryGuard = 0;
                      return 0;
                    }
                  es1s2s2s1:;
                  } // End of DO block
              }
          } // End of DO for-loop block
        es1s2:;
        } // End of DO block
    es1:;
    } // End of DO block
  {
    reentryGuard = 0;
    return 0;
  }
}
