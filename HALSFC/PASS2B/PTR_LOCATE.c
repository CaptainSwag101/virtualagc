/*
  File PTR_LOCATE.c generated by XCOM-I, 2024-08-09 12:41:32.
*/

#include "runtimeC.h"

int32_t
PTR_LOCATE (int reset)
{
  static int reentryGuard = 0;
  if (reset)
    {
      reentryGuard = 0;
      return (int32_t)0;
    }
  reentryGuard = guardReentry (reentryGuard, "PTR_LOCATE");
  // PAGE = SHR(PTR,16) &  65535; (686)
  {
    int32_t numberRHS
        = (int32_t)(xAND (SHR (getFIXED (mPTR_LOCATExPTR), 16), 65535));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mPTR_LOCATExPAGE, bitRHS);
    bitRHS->inUse = 0;
  }
  // OFFSET = PTR &  65535; (687)
  {
    int32_t numberRHS = (int32_t)(xAND (getFIXED (mPTR_LOCATExPTR), 65535));
    descriptor_t *bitRHS;
    bitRHS = fixedToBit (32, (int32_t)(numberRHS));
    putBIT (16, mPTR_LOCATExOFFSET, bitRHS);
    bitRHS->inUse = 0;
  }
  // IF OFFSET >= VMEM_PAGE_SIZE THEN (688)
  if (1 & (xGE (COREHALFWORD (mPTR_LOCATExOFFSET), 3360)))
    // CALL BAD_PTR; (689)
    PTR_LOCATExBAD_PTR (0);
  // IF PAGE = VMEM_PRIOR_PAGE THEN (690)
  if (1
      & (xEQ (COREHALFWORD (mPTR_LOCATExPAGE),
              COREHALFWORD (mVMEM_PRIOR_PAGE))))
    // DO; (691)
    {
    rs1:;
      // VMEM_LOC_PTR = PTR; (692)
      {
        int32_t numberRHS = (int32_t)(getFIXED (mPTR_LOCATExPTR));
        putFIXED (mVMEM_LOC_PTR, numberRHS);
      }
      // VMEM_LOC_ADDR = VMEM_PAD_ADDR(VMEM_OLD_NDX) + OFFSET; (693)
      {
        int32_t numberRHS = (int32_t)(xadd (
            getFIXED (mVMEM_PAD_ADDR + 4 * COREHALFWORD (mVMEM_OLD_NDX)),
            COREHALFWORD (mPTR_LOCATExOFFSET)));
        putFIXED (mVMEM_LOC_ADDR, numberRHS);
      }
      // IF FLAGS ~= 0 THEN (694)
      if (1 & (xNEQ (BYTE0 (mPTR_LOCATExFLAGS), 0)))
        // CALL DISP(FLAGS); (695)
        {
          putBITp (8, mDISPxFLAGS, getBIT (8, mPTR_LOCATExFLAGS));
          DISP (0);
        }
      // RETURN; (696)
      {
        reentryGuard = 0;
        return 0;
      }
    es1:;
    } // End of DO block
  // VMEM_PRIOR_PAGE = PAGE; (697)
  {
    descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExPAGE);
    putBIT (16, mVMEM_PRIOR_PAGE, bitRHS);
    bitRHS->inUse = 0;
  }
  // VMEM_LOC_CNT = VMEM_LOC_CNT + 1; (698)
  {
    int32_t numberRHS = (int32_t)(xadd (getFIXED (mVMEM_LOC_CNT), 1));
    putFIXED (mVMEM_LOC_CNT, numberRHS);
  }
  // IF PAGE > VMEM_LAST_PAGE THEN (699)
  if (1
      & (xGT (COREHALFWORD (mPTR_LOCATExPAGE),
              COREHALFWORD (mVMEM_LAST_PAGE))))
    // DO; (700)
    {
    rs2:;
      // IF (PAGE-1)~=VMEM_LAST_PAGE THEN (701)
      if (1
          & (xNEQ (xsubtract (COREHALFWORD (mPTR_LOCATExPAGE), 1),
                   COREHALFWORD (mVMEM_LAST_PAGE))))
        // CALL BAD_PTR; (702)
        PTR_LOCATExBAD_PTR (0);
      // VMEM_LAST_PAGE = PAGE; (703)
      {
        descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExPAGE);
        putBIT (16, mVMEM_LAST_PAGE, bitRHS);
        bitRHS->inUse = 0;
      }
      // VMEM_PAGE_AVAIL_SPACE(VMEM_LAST_PAGE) = VMEM_PAGE_SIZE; (704)
      {
        int32_t numberRHS = (int32_t)(3360);
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (16,
                mVMEM_PAGE_AVAIL_SPACE + 2 * (COREHALFWORD (mVMEM_LAST_PAGE)),
                bitRHS);
        bitRHS->inUse = 0;
      }
      // IF VMEM_LAST_PAGE <= VMEM_MAX_PAGE THEN (705)
      if (1
          & (xLE (COREHALFWORD (mVMEM_LAST_PAGE),
                  COREHALFWORD (mVMEM_MAX_PAGE))))
        // DO; (706)
        {
        rs2s1:;
          // CUR_NDX = VMEM_LAST_PAGE; (707)
          {
            descriptor_t *bitRHS = getBIT (16, mVMEM_LAST_PAGE);
            putBIT (16, mPTR_LOCATExCUR_NDX, bitRHS);
            bitRHS->inUse = 0;
          }
        es2s1:;
        } // End of DO block
      // ELSE (708)
      else
        // DO; (709)
        {
        rs2s2:;
          // IF VMEM_LAST_PAGE > VMEM_TOTAL_PAGES THEN (710)
          if (1 & (xGT (COREHALFWORD (mVMEM_LAST_PAGE), 399)))
            // DO; (711)
            {
            rs2s2s1:;
              // OUTPUT = '*** VIRTUAL MEMORY CAPACITY EXHAUSTED ***'; (712)
              {
                descriptor_t *stringRHS;
                stringRHS = cToDescriptor (
                    NULL, "*** VIRTUAL MEMORY CAPACITY EXHAUSTED ***");
                OUTPUT (0, stringRHS);
                stringRHS->inUse = 0;
              }
              // CALL EXIT; (713)
              EXIT ();
            es2s2s1:;
            } // End of DO block
          // CALL PAGING_STRATEGY; (714)
          PTR_LOCATExPAGING_STRATEGY (0);
        es2s2:;
        } // End of DO block
      // FLAGS = FLAGS|MODF; (715)
      {
        int32_t numberRHS
            = (int32_t)(xOR (BYTE0 (mPTR_LOCATExFLAGS), BYTE0 (mMODF)));
        descriptor_t *bitRHS;
        bitRHS = fixedToBit (32, (int32_t)(numberRHS));
        putBIT (8, mPTR_LOCATExFLAGS, bitRHS);
        bitRHS->inUse = 0;
      }
      // CALL ZERO_CORE(VMEM_PAD_ADDR(CUR_NDX),VMEM_PAGE_SIZE); (716)
      {
        putFIXED (mZERO_CORExCORE_ADDR,
                  getFIXED (mVMEM_PAD_ADDR
                            + 4 * COREHALFWORD (mPTR_LOCATExCUR_NDX)));
        putFIXED (mZERO_CORExCOUNT, 3360);
        ZERO_CORE (0);
      }
      // GO TO LOC_COMMON1; (717)
      goto LOC_COMMON1;
    es2:;
    } // End of DO block
  // ELSE (718)
  else
    // DO; (719)
    {
    rs3:;
      // CUR_NDX = VMEM_PAGE_TO_NDX(PAGE); (720)
      {
        descriptor_t *bitRHS = getBIT (
            16, mVMEM_PAGE_TO_NDX + 2 * COREHALFWORD (mPTR_LOCATExPAGE));
        putBIT (16, mPTR_LOCATExCUR_NDX, bitRHS);
        bitRHS->inUse = 0;
      }
      // IF CUR_NDX = -1 THEN (721)
      if (1 & (xEQ (COREHALFWORD (mPTR_LOCATExCUR_NDX), -1)))
        // DO; (722)
        {
        rs3s1:;
          // CALL PAGING_STRATEGY; (723)
          PTR_LOCATExPAGING_STRATEGY (0);
          // IF VMEM_LOOK_AHEAD_PAGE >= 0 THEN (724)
          if (1 & (xGE (COREHALFWORD (mVMEM_LOOK_AHEAD_PAGE), 0)))
            // DO; (725)
            {
            rs3s1s1:;
              // CALL MONITOR(31,0,-1); (726)
              MONITOR31 (0, -1);
              // VMEM_LOOK_AHEAD_PAGE = -1; (727)
              {
                int32_t numberRHS = (int32_t)(-1);
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mVMEM_LOOK_AHEAD_PAGE, bitRHS);
                bitRHS->inUse = 0;
              }
            es3s1s1:;
            } // End of DO block
          // COREWORD(ADDR(VMEM_PAGE)) = VMEM_PAD_ADDR(CUR_NDX); (728)
          {
            int32_t numberRHS = (int32_t)(getFIXED (
                mVMEM_PAD_ADDR + 4 * COREHALFWORD (mPTR_LOCATExCUR_NDX)));
            COREWORD2 (ADDR ("PTR_LOCATExVMEM_PAGE", 0x80000000, NULL, 0),
                       numberRHS);
          }
          // VMEM_PAGE = FILE(VMEM_FILE#,PAGE); (729)
          {
            rFILE (ADDR ("PTR_LOCATExVMEM_PAGE", 0, NULL, 0), 6,
                   COREHALFWORD (mPTR_LOCATExPAGE));
          }
          // VMEM_READ_CNT = VMEM_READ_CNT + 1; (730)
          {
            int32_t numberRHS = (int32_t)(xadd (getFIXED (mVMEM_READ_CNT), 1));
            putFIXED (mVMEM_READ_CNT, numberRHS);
          }
        // LOC_COMMON1: (731)
        LOC_COMMON1:
          // VMEM_PAGE_TO_NDX(PAGE) = CUR_NDX; (732)
          {
            descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExCUR_NDX);
            putBIT (16,
                    mVMEM_PAGE_TO_NDX + 2 * (COREHALFWORD (mPTR_LOCATExPAGE)),
                    bitRHS);
            bitRHS->inUse = 0;
          }
          // VMEM_PAD_PAGE(CUR_NDX) = PAGE; (733)
          {
            descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExPAGE);
            putBIT (16,
                    mVMEM_PAD_PAGE + 2 * (COREHALFWORD (mPTR_LOCATExCUR_NDX)),
                    bitRHS);
            bitRHS->inUse = 0;
          }
          // VMEM_PAD_DISP(CUR_NDX) = 0; (734)
          {
            int32_t numberRHS = (int32_t)(0);
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16,
                    mVMEM_PAD_DISP + 2 * (COREHALFWORD (mPTR_LOCATExCUR_NDX)),
                    bitRHS);
            bitRHS->inUse = 0;
          }
        es3s1:;
        } // End of DO block
      // ELSE (735)
      else
        // DO; (736)
        {
        rs3s2:;
          // IF PAGE = VMEM_LOOK_AHEAD_PAGE THEN (737)
          if (1
              & (xEQ (COREHALFWORD (mPTR_LOCATExPAGE),
                      COREHALFWORD (mVMEM_LOOK_AHEAD_PAGE))))
            // DO; (738)
            {
            rs3s2s1:;
              // CALL MONITOR(31,0,-1); (739)
              MONITOR31 (0, -1);
              // VMEM_LOOK_AHEAD_PAGE = -1; (740)
              {
                int32_t numberRHS = (int32_t)(-1);
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16, mVMEM_LOOK_AHEAD_PAGE, bitRHS);
                bitRHS->inUse = 0;
              }
            es3s2s1:;
            } // End of DO block
        es3s2:;
        } // End of DO block
      // VMEM_PAD_CNT(CUR_NDX) = VMEM_LOC_CNT; (741)
      {
        int32_t numberRHS = (int32_t)(getFIXED (mVMEM_LOC_CNT));
        putFIXED (mVMEM_PAD_CNT + 4 * (COREHALFWORD (mPTR_LOCATExCUR_NDX)),
                  numberRHS);
      }
    es3:;
    } // End of DO block
  // VMEM_OLD_NDX = CUR_NDX; (742)
  {
    descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExCUR_NDX);
    putBIT (16, mVMEM_OLD_NDX, bitRHS);
    bitRHS->inUse = 0;
  }
  // VMEM_LOC_PTR = PTR; (743)
  {
    int32_t numberRHS = (int32_t)(getFIXED (mPTR_LOCATExPTR));
    putFIXED (mVMEM_LOC_PTR, numberRHS);
  }
  // VMEM_LOC_ADDR = VMEM_PAD_ADDR(CUR_NDX) + OFFSET; (744)
  {
    int32_t numberRHS = (int32_t)(xadd (
        getFIXED (mVMEM_PAD_ADDR + 4 * COREHALFWORD (mPTR_LOCATExCUR_NDX)),
        COREHALFWORD (mPTR_LOCATExOFFSET)));
    putFIXED (mVMEM_LOC_ADDR, numberRHS);
  }
  // IF FLAGS ~= 0 THEN (745)
  if (1 & (xNEQ (BYTE0 (mPTR_LOCATExFLAGS), 0)))
    // CALL DISP(FLAGS); (746)
    {
      putBITp (8, mDISPxFLAGS, getBIT (8, mPTR_LOCATExFLAGS));
      DISP (0);
    }
  // IF VMEM_LOOK_AHEAD THEN (747)
  if (1 & (bitToFixed (getBIT (1, mVMEM_LOOK_AHEAD))))
    // DO; (748)
    {
    rs4:;
      // IF PAGE < VMEM_LAST_PAGE THEN (749)
      if (1
          & (xLT (COREHALFWORD (mPTR_LOCATExPAGE),
                  COREHALFWORD (mVMEM_LAST_PAGE))))
        // DO; (750)
        {
        rs4s1:;
          // PAGE = PAGE + 1; (751)
          {
            int32_t numberRHS
                = (int32_t)(xadd (COREHALFWORD (mPTR_LOCATExPAGE), 1));
            descriptor_t *bitRHS;
            bitRHS = fixedToBit (32, (int32_t)(numberRHS));
            putBIT (16, mPTR_LOCATExPAGE, bitRHS);
            bitRHS->inUse = 0;
          }
          // CUR_NDX = VMEM_PAGE_TO_NDX(PAGE); (752)
          {
            descriptor_t *bitRHS = getBIT (
                16, mVMEM_PAGE_TO_NDX + 2 * COREHALFWORD (mPTR_LOCATExPAGE));
            putBIT (16, mPTR_LOCATExCUR_NDX, bitRHS);
            bitRHS->inUse = 0;
          }
          // IF CUR_NDX = -1 THEN (753)
          if (1 & (xEQ (COREHALFWORD (mPTR_LOCATExCUR_NDX), -1)))
            // DO; (754)
            {
            rs4s1s1:;
              // VMEM_PAD_DISP(VMEM_OLD_NDX) = VMEM_PAD_DISP(VMEM_OLD_NDX) + 1;
              // (755)
              {
                int32_t numberRHS = (int32_t)(xadd (
                    COREHALFWORD (mVMEM_PAD_DISP
                                  + 2 * COREHALFWORD (mVMEM_OLD_NDX)),
                    1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16,
                        mVMEM_PAD_DISP + 2 * (COREHALFWORD (mVMEM_OLD_NDX)),
                        bitRHS);
                bitRHS->inUse = 0;
              }
              // IF VMEM_LAST_PAGE <= VMEM_MAX_PAGE THEN (756)
              if (1
                  & (xLE (COREHALFWORD (mVMEM_LAST_PAGE),
                          COREHALFWORD (mVMEM_MAX_PAGE))))
                // CUR_NDX = VMEM_LAST_PAGE; (757)
                {
                  descriptor_t *bitRHS = getBIT (16, mVMEM_LAST_PAGE);
                  putBIT (16, mPTR_LOCATExCUR_NDX, bitRHS);
                  bitRHS->inUse = 0;
                }
              // ELSE (758)
              else
                // CALL PAGING_STRATEGY; (759)
                PTR_LOCATExPAGING_STRATEGY (0);
              // VMEM_PAD_DISP(VMEM_OLD_NDX) = VMEM_PAD_DISP(VMEM_OLD_NDX) - 1;
              // (760)
              {
                int32_t numberRHS = (int32_t)(xsubtract (
                    COREHALFWORD (mVMEM_PAD_DISP
                                  + 2 * COREHALFWORD (mVMEM_OLD_NDX)),
                    1));
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16,
                        mVMEM_PAD_DISP + 2 * (COREHALFWORD (mVMEM_OLD_NDX)),
                        bitRHS);
                bitRHS->inUse = 0;
              }
              // BUFF_ADDR = VMEM_PAD_ADDR(CUR_NDX); (761)
              {
                int32_t numberRHS = (int32_t)(getFIXED (
                    mVMEM_PAD_ADDR + 4 * COREHALFWORD (mPTR_LOCATExCUR_NDX)));
                putFIXED (mPTR_LOCATExBUFF_ADDR, numberRHS);
              }
              // IF VMEM_LOOK_AHEAD_PAGE >= 0 THEN (762)
              if (1 & (xGE (COREHALFWORD (mVMEM_LOOK_AHEAD_PAGE), 0)))
                // BUFF_ADDR = BUFF_ADDR |  2147483648; (763)
                {
                  int32_t numberRHS = (int32_t)(xOR (
                      getFIXED (mPTR_LOCATExBUFF_ADDR), 2147483648));
                  putFIXED (mPTR_LOCATExBUFF_ADDR, numberRHS);
                }
              // CALL MONITOR(31,BUFF_ADDR,PAGE); (764)
              MONITOR31 (getFIXED (mPTR_LOCATExBUFF_ADDR),
                         COREHALFWORD (mPTR_LOCATExPAGE));
              // VMEM_LOOK_AHEAD_PAGE = PAGE; (765)
              {
                descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExPAGE);
                putBIT (16, mVMEM_LOOK_AHEAD_PAGE, bitRHS);
                bitRHS->inUse = 0;
              }
              // VMEM_READ_CNT = VMEM_READ_CNT + 1; (766)
              {
                int32_t numberRHS
                    = (int32_t)(xadd (getFIXED (mVMEM_READ_CNT), 1));
                putFIXED (mVMEM_READ_CNT, numberRHS);
              }
              // VMEM_PAGE_TO_NDX(PAGE) = CUR_NDX; (767)
              {
                descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExCUR_NDX);
                putBIT (16,
                        mVMEM_PAGE_TO_NDX
                            + 2 * (COREHALFWORD (mPTR_LOCATExPAGE)),
                        bitRHS);
                bitRHS->inUse = 0;
              }
              // VMEM_PAD_PAGE(CUR_NDX) = PAGE; (768)
              {
                descriptor_t *bitRHS = getBIT (16, mPTR_LOCATExPAGE);
                putBIT (16,
                        mVMEM_PAD_PAGE
                            + 2 * (COREHALFWORD (mPTR_LOCATExCUR_NDX)),
                        bitRHS);
                bitRHS->inUse = 0;
              }
              // VMEM_PAD_DISP(CUR_NDX) = 0; (769)
              {
                int32_t numberRHS = (int32_t)(0);
                descriptor_t *bitRHS;
                bitRHS = fixedToBit (32, (int32_t)(numberRHS));
                putBIT (16,
                        mVMEM_PAD_DISP
                            + 2 * (COREHALFWORD (mPTR_LOCATExCUR_NDX)),
                        bitRHS);
                bitRHS->inUse = 0;
              }
              // VMEM_PAD_CNT(CUR_NDX) = VMEM_LOC_CNT - 1; (770)
              {
                int32_t numberRHS
                    = (int32_t)(xsubtract (getFIXED (mVMEM_LOC_CNT), 1));
                putFIXED (mVMEM_PAD_CNT
                              + 4 * (COREHALFWORD (mPTR_LOCATExCUR_NDX)),
                          numberRHS);
              }
            es4s1s1:;
            } // End of DO block
        es4s1:;
        } // End of DO block
    es4:;
    } // End of DO block
  {
    reentryGuard = 0;
    return 0;
  }
}
